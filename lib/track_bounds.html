<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>track_bounds</title>
<link href="../as2-doc.css" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
<script src="../as2-doc.js" type="text/javascript"></script>
</head>
<body>
<h1 id="about">About</h1>
<address>Author: DeathByNukes (<a href="http://deathbynukes.com/">deathbynukes.com</a>)</address>
<p>This is a part of my <a href="index.html">Audiosurf 2 scripting library</a>.</p>
<h1 id="contents">Contents</h1>
<script type="text/javascript">writeNavigation();</script>
<h1>track_bounds</h1>
<p>Calculates various information about the size of the level. Depends on my <a href="vector.html#vec3">vec3</a> library.</p>
<pre class="NppLua"><span class="sc11">track</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">track_vec3s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetTrack</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">
</span><span class="sc5">do</span><span class="sc0">
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">track</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">track_vec3s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vec3</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">track</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">track_vec3s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vec3</span><span class="sc0">
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc14">min</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc14">max</span><span class="sc0">
    </span><span class="sc5">do</span><span class="sc0">
        </span><span class="sc11">track_vec3s</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vec3.fromApi</span><span class="sc10">(</span><span class="sc11">track</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">].</span><span class="sc11">pos</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">minx</span><span class="sc10">,</span><span class="sc11">miny</span><span class="sc10">,</span><span class="sc11">minz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">unpack</span><span class="sc10">(</span><span class="sc11">track_vec3s</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0">
        </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">maxx</span><span class="sc10">,</span><span class="sc11">maxy</span><span class="sc10">,</span><span class="sc11">maxz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">minx</span><span class="sc10">,</span><span class="sc11">miny</span><span class="sc10">,</span><span class="sc11">minz</span><span class="sc0">
        
        </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">z</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">2</span><span class="sc10">,#</span><span class="sc11">track</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
            </span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">track</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">pos</span><span class="sc0">
            </span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pos.x</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pos.y</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pos.z</span><span class="sc0">
            </span><span class="sc11">track_vec3s</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc11">y</span><span class="sc10">,</span><span class="sc11">z</span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">minx</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">minx</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc5">elseif</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">maxx</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">maxx</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc5">end</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">miny</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">miny</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc5">elseif</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">maxy</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">maxy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc5">end</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">minz</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">minz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc5">elseif</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">maxz</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">maxz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc5">end</span><span class="sc0">
        </span><span class="sc5">end</span><span class="sc0">
        
        </span><span class="sc14">min</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc14">max</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">minx</span><span class="sc10">,</span><span class="sc11">miny</span><span class="sc10">,</span><span class="sc11">minz</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">maxx</span><span class="sc10">,</span><span class="sc11">maxy</span><span class="sc10">,</span><span class="sc11">maxz</span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">end</span><span class="sc0">
    
    </span><span class="sc2">-- approximate the size of the rail geometry
</span><span class="sc0">    </span><span class="sc5">do</span><span class="sc0">
        </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">side</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">up</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">down</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetSkinProperties().trackwidth</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">36</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc0">
        </span><span class="sc11">node_bounds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">side</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">side</span><span class="sc10">,</span><span class="sc0">
            </span><span class="sc11">up</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">up</span><span class="sc10">,</span><span class="sc0">
            </span><span class="sc11">down</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">down</span><span class="sc10">,</span><span class="sc0">
            </span><span class="sc14">min</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{-</span><span class="sc11">side</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">down</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">side</span><span class="sc10">},</span><span class="sc0">
            </span><span class="sc14">max</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">side</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc11">up</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc11">side</span><span class="sc10">},</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">end</span><span class="sc0">
    </span><span class="sc11">track_bounds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">node_min</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vec3.add</span><span class="sc10">(</span><span class="sc14">min</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">node_bounds.min</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">node_max</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vec3.add</span><span class="sc10">(</span><span class="sc14">max</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">node_bounds.max</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc14">min</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc14">min</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">-- this is the bounds that AS2 uses internally
</span><span class="sc0">        </span><span class="sc14">max</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc14">max</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">track_bounds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">track_bounds</span><span class="sc0">
    </span><span class="sc11">track_bounds.node_center</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vec3.avg</span><span class="sc10">(</span><span class="sc11">track_bounds.node_min</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">track_bounds.node_max</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">track_bounds.center</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vec3.avg</span><span class="sc10">(</span><span class="sc11">track_bounds.min</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">track_bounds.max</span><span class="sc10">)</span><span class="sc0">
    
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">cx</span><span class="sc10">,</span><span class="sc11">cz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">track_bounds.node_center</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">track_bounds.node_center</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]</span><span class="sc0">
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc11">dist</span><span class="sc0">
    </span><span class="sc5">local</span><span class="sc0"> </span><span class="sc14">max</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">,#</span><span class="sc11">track</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
        </span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">track_vec3s</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">cx</span><span class="sc10">)^</span><span class="sc4">2</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pos</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">cz</span><span class="sc10">)^</span><span class="sc4">2</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc14">max</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc14">max</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc5">end</span><span class="sc0">
    </span><span class="sc5">end</span><span class="sc0">
    </span><span class="sc11">track_bounds.node_center_horizontal_radius</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc14">math.sqrt</span><span class="sc10">(</span><span class="sc14">max</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">node_bounds.side</span><span class="sc0">
</span><span class="sc5">end</span></pre>
</body>
</html>