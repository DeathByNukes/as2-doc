<!DOCTYPE html>
<html><!-- InstanceBegin template="/Templates/as2-doc-main.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta charset="utf-8">
<link href="as2-doc.css" rel="stylesheet" type="text/css">
<script src="jquery.min.js" type="text/javascript"></script>
<script src="as2-doc.js" type="text/javascript"></script>
<!-- InstanceBeginEditable name="head" -->
<title>Skins</title>
<!-- InstanceEndEditable -->
</head>
<body>
<h1 id="about">About</h1>
<address>Author: <a href="index.html#contact">DeathByNukes</a></address>
<p>This is a part of my <a href="index.html">Audiosurf 2 scripting documentation</a>.</p>
<!-- InstanceBeginEditable name="pre-content" -->
<p>This page documents the version released <a href="changelog.html#14">May ‎29, ‎2014</a>. Some changes have been integrated since then but it is currently inconsistent.</p>
<!-- InstanceEndEditable -->
<h1 id="format">Documentation Format</h1>
<code><span class="example_type">type</span> <strong>name</strong> = default or choice2 or choice3 <em>-- extra information</em></code>
<p>If I write <code><strong>?=</strong></code> instead of <code><strong>=</strong></code> that means omitting the value will cause the existing value or default to be preserved. Only matters if you're calling the function more than once.</p>
<h1 id="contents">Contents</h1>
<script type="text/javascript">writeNavigation();</script>
<h1 id="types">Types</h1>
<script type="text/javascript">writeTypes();</script>
<!-- InstanceBeginEditable name="content" -->




<h1 id="script-execution">Script Execution</h1>
<p>The skin script is executed during the loading screen when starting a song. A function in the script named <code><a href="#Update" class="func">Update()</a></code>, if present, will be executed every frame during actual gameplay.</p>


<h2 id="Update">Update(<a href="#type-float">float</a>, <a href="#type-float">float</a>, <a href="#type-float">float</a>, <a href="#type-float">float</a>, <a href="#type-float">float</a>)</h2>
<p>This function is executed inside of <a href="https://docs.unity3d.com/Documentation/ScriptReference/MonoBehaviour.LateUpdate.html">Unity's LateUpdate</a> function.<br>
Arguments:</p>
<pre><code><a href="#type-float">float</a> <strong>dt</strong> <em>-- the current value of <a href="https://docs.unity3d.com/Documentation/ScriptReference/Time-deltaTime.html">Unity's deltaTime</a> value</em>
<a href="#type-float">float</a> <strong>tracklocation</strong> <em>-- The fractional index of the track node that the player is currently &quot;on&quot;. (When the player is halfway between nodes 3 and 4, CurrentNode is 3.5)</em>
<a href="#type-float">float</a> <strong>playerstrafe</strong> <em>-- the player's current offset from the center of the track</em>
<a href="#type-float">float</a> <strong>currentWakeboarderJumpHeight</strong>
float intensity <em>-- the same as <a href="#GetIntensity">GetIntensity</a>()</em></code></pre>




<h1 id="script-functions">Script Functions</h1>


<h2 id="print">print(<a href="#type-string">string</a>)</h2>
<p>Outputs the specified string to "Audiosurf2_Data\output_log.txt".</p>
<pre class="NppLua"><code><span class="sc13">print</span><span class="sc10">(</span><span class="sc6">"Track width: "</span><span class="sc0"> </span><span class="sc10">..</span><span class="sc0"> </span><span class="sc11">trackWidth</span><span class="sc10">)</span></code></pre>
<script type="text/javascript">writeScriptFunctions();</script>


<h2 id="PlayerCanJump"><a href="#type-bool">bool</a> PlayerCanJump()</h2>
<p>The current mod allows jumping. (wakeboard mod etc)</p>


<h2 id="Profile">Profile(<a href="#type-string">string</a>)</h2>
<p><a href="#print">Prints</a> the amount of time elapsed since the last time this function was called. The argument should be the name of your skin.</p>


<h2 id="GetTrack"><a href="#type-table">table</a><a href="#type-array">[]</a> GetTrack()</h2>
<pre><code><a href="#type-table">table</a> <strong>pos</strong> {
	<a href="#type-float">float</a> <strong>x</strong>
	<a href="#type-float">float</a> <strong>y</strong>
	<a href="#type-float">float</a> <strong>z</strong>
}
<a href="#type-float">float</a> <strong>seconds</strong>
<a href="#type-table">table</a> <strong>color</strong> {
	<a href="#type-float">float</a> <strong>r</strong>
	<a href="#type-float">float</a> <strong>g</strong>
	<a href="#type-float">float</a> <strong>b</strong>
	<a href="#type-float">float</a> <strong>a</strong>
}
<em>-- the following rotation values are in degrees. they are the node's absolute rotation not delta</em>
<a href="#type-float">float</a> <strong>pan</strong> <em>-- rotation around the y axis</em>
<a href="#type-float">float</a> <strong>tilt</strong> <em>-- x</em>
<a href="#type-float">float</a> <strong>roll</strong> <em>-- z</em>
vector3 rot <em>-- same as {tilt, pan, roll}</em>
<a href="#type-float">float</a> <strong>intensity</strong> <em>-- normalized <a href="glossary.html#intensity">intensity</a></em>
bool funkyrot <em>-- if this is in a corkscrew or loop</em>
float antiairtime <em>-- "anti jump seconds"</em>
float trafficstrength
float antitrafficstrength</code></pre>


<h2 id="GetIntensity"><a href="#type-float">float</a> GetIntensity()</h2>
<p>The current normalized <a href="glossary.html#intensity">intensity</a>.</p>
<ul class="seealso">
	<li><a href="#Update">Update</a></li>
</ul>


<h2 id="GetSpectrum"><a href="#type-float">float</a><a href="#type-array">[16]</a> GetSpectrum()</h2>
<p>An alias of <code><a href="#UpdateSpectrum" class=func>UpdateSpectrum</a>(<strong>nil</strong>)</code></p>


<h2 id="UpdateSpectrum"><a href="#type-float">float</a><a href="#type-array">[16]</a>/<a href="#type-table">table</a> UpdateSpectrum(<a href="#type-table">table</a>)</h2>
<p>Gets the music frequency spectrum of the current point in song playback. If you pass a <code><a href="#type-table">table</a></code> as the argument, it will <a href="https://www.lua.org/manual/5.1/manual.html#pdf-rawset">set</a> the spectrum values into that table instead of creating a new table. (Reusing the same table every frame improves performance.)</p>
<ul class="seealso">
	<li><a href="#Update">Update</a></li>
</ul>

<h3 id="UpdateSpectrum-internal">What it Does</h3>
<ol>
	<li>The <a href="https://github.com/mborgerding/kissfft">Kiss FFT</a> library is used to do a <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform">Fast Fourier Transform</a> of the current point in the song. I can't tell what it does here because it's compiled C++.</li>
	<li>The C++ code returns an array of 512 float numbers. They seem to be frequency bins containing the magnitude squared. (a^2 + b^2)</li>
	<li>The bins are broken up into groups of 32 and the average of each group is calculated, resulting in 16 bins.</li>
</ol>
<p>The magnitude seems to be in the range 0 to 2. From what I've read, this way of producing a smaller spectrum is technically different from what you would get if you directly calculated a 16 bin spectrum. A smaller FFT would use information from a smaller time span and so change more rapidly.</p>

<h3 id="UpdateSpectrum-math">How to Interpret It</h3>
<pre class=LuaCode><code>spectrum = UpdateSpectrum(spectrum)
for i=1,#spectrum do
	local bin = spectrum[i]
	<em>-- To get the magnitude of a bin:</em>
	local magnitude = math.sqrt(bin)
	<em>-- To convert the above magnitude to decibels:</em>
	local db = 20 * math.log10(magnitude / 2)
	<em>-- If you aren't going to use magnitude, you can optimize the decibels equation:</em>
	local db = 10 * math.log10(bin / 4)
	<em>-- Getting the above values in a useful 0 to 1 range:</em>
	local magnitude_normalized = magnitude / 2
	local db_normalized = math.min(0, (db + 60) / 60) <em>-- Cut off values less than -60db.</em>
end</code></pre>
<ul class="seealso">
	<li><a href="https://stackoverflow.com/questions/4675457/how-to-generate-the-audio-spectrum-using-fft-in-c">How to generate the audio spectrum using fft in C++?</a></li>
</ul>

<h3 id="UpdateSpectrum-glitch">Glitch</h3>
<p>Currently, the beginning and end sections of gameplay when audio isn't playing are glitched. In the beginning the spectrum returns unpredictable random values as if it is reinterpreting arbitrary memory. In the end, the values either freeze at their last position or produce more noise. Here is how you can deal with that if it causes you problems:</p>
<pre class=LuaCode><code>track = GetTrack() <em>-- Your skin probably already does this. Avoid doing it more than once because it's expensive.</em>

<em>-- Some extra nodes with negative time are added to the start of the track.</em>
local first_real_node
for i=1,#track do
	if track[i].seconds >= 0 then
		first_real_node = i
		break
	end
end
if first_real_node == nil then error("negative length song") end

<em>-- Currently the number of extra nodes at the end is always 44. They are clones of the last node with modified position/seconds and zero maxair/trafficstrength.</em>
local last_real_node = #track - 44

local spectrum, UpdateSpectrum = GetSpectrum(), UpdateSpectrum
function Update()
	if location >= first and location <= last then
		UpdateSpectrum(spectrum)
	else
		for i=1,#spectrum do spectrum[i] = 0 end
	end
	<em>-- Do things with the spectrum here.</em>
end</code></pre>


<h2 id="GetLogSpectrum"><a href="#type-float">float</a><a href="#type-array">[16]</a> GetLogSpectrum()</h2>
<p>I have only skimmed the code but it looks like this is a variant of <code><a href="#GetSpectrum" class=func>GetSpectrum</a></code> that splits up the 512 bin spectrum logarithmically rather than linearly before averaging them down to 16. (&quot;horizontal&quot; log scale) The numeric scale of the individual bins (&quot;vertical&quot; scale) is the same as the regular spectrum. It seems to have been forgotten about when <code><a href="#UpdateSpectrum" class=func>UpdateSpectrum</a></code> was added.</p>


<h2 id="UpdateSpectrum512"><a href="#type-float">float</a><a href="#type-array">[512]</a>/<a href="#type-table">table</a> UpdateSpectrum512(<a href="#type-table">table</a>)</h2>
<p>This gets the full 512 bin audio spectrum that <code><a href="#UpdateSpectrum" class=func>UpdateSpectrum</a></code> and <code><a href="#GetLogSpectrum" class=func>GetLogSpectrum</a></code> read from internally to produce their results.</p>


<h2 id="GetMillisecondsSinceStartup"><a href="#type-float">float</a> GetMillisecondsSinceStartup()</h2>
<p>Unity's <a href="https://docs.unity3d.com/ScriptReference/Time-realtimeSinceStartup.html">Time.realtimeSinceStartup</a> * 1000.</p>
<p>Note that this is the time since Audiosurf 2 started (potentially more than an hour ago) not the time since this particular track started. Can be useful as a seed to <code><a href="https://www.lua.org/manual/5.1/manual.html#pdf-math.randomseed">math.randomseed</a></code> if non-deterministic behavior is desired. (By default it is seeded with the song length.)</p>


<h2 id="GetHighwayColor"><a href="#type-color">color</a> GetHighwayColor()</h2>
<p>Gets the highway color at the current point in song playback. The returned table contains both styles of color. (<code>color.r</code> and <code>color[1]</code> are equivalent)</p>


<h2 id="GetSongCompletionPercentage"><a href="#type-float">float</a> GetSongCompletionPercentage()</h2>
<p>The current point in song playback. The returned number ranges from 0.0 to 1.0.</p>


<h2 id="GetSkinProperties"><a href="#type-dict">{</a><a href="#type-string">string</a><a href="#type-dict">=</a>*<a href="#type-dict">}</a> GetSkinProperties()</h2>
<p>Output:</p>
<pre><code><a href="#type-bool">bool</a> <strong>*</strong>
<a href="#type-double">double</a> <strong>*</strong>
<a href="#type-string">string</a> <strong>*</strong>
<a href="#type-dict">{</a>*<a href="#type-dict">=</a>*<a href="#type-dict">}</a> <strong>*</strong> <em>-- Keys and values can be a mixture of <a href="#type-bool">bool</a>, <a href="#type-double">double</a>, and <a href="#type-string">string</a>.</em>
<a href="#type-int">int</a> <strong>colorcount</strong> <em>-- Set by <a href="mods.html#GameplaySettings" class=func>GameplaySettings</a>{<strong>colorcount</strong>}, defaults to 1.</em></code></pre>
<p>Mods can add whatever values they want to the table as long they are one of the basic Lua types. The values can also be Lua tables with keys and values of any of the basic types. Functions and deeper nested tables are not supported, but mods could include them as strings and the skin could convert the strings into Lua code via <code><a href="https://www.lua.org/manual/5.1/manual.html#pdf-loadstring" class=func>loadstring</a>()</code>. Mods can add and overwrite skin properties at any time; skins can call the function again during <code><a href="#Update" class=func>Update</a></code> to see the changes. (The automatic system used internally to transfer the values from mods to skins also supports <a href="https://www.lua.org/manual/5.1/manual.html#lua_pushlightuserdata">light userdata</a>, but I don't think Audiosurf 2 ever produces that type and it can't be created by scripts.)</p>

<h3 id="GetSkinProperties-default">Default Properties</h3>
<p>These are the default entries that usually get overwritten by mods:</p>
<pre class=LuaCode><code><a href="mods.html#SetSkinProperties" class=func>SetSkinProperties</a>{
	lanedividers = {-1.5, 1.5},
	shoulderlines = {4.5, -4.5}, <em>-- [sic]</em>
	trackwidth = 11.6,
	prefersteep = false,
}</code></pre>

<h3 id="GetSkinProperties-standard">Standard Properties</h3>
<p>These are the properties set by built-in mods and the ones based on them:</p>
<pre><code><a href="#type-double">double</a> <strong>trackwidth</strong>
<a href="#type-bool">bool</a> <strong>prefersteep</strong>
<a href="#type-double">double</a><a href="#type-array">[]</a> <strong>lanedividers</strong>
<a href="#type-double">double</a><a href="#type-array">[]</a> <strong>shoulderlines</strong></code></pre>

<h3 id="GetSkinProperties-extended">Extended Properties</h3>
<p>Here are extra properties I have been voluntarily supporting in my skins:</p>
<pre><code><a href="#type-double">double</a> <strong>disableWater</strong> <em>-- set a nonzero number to disable water</em>
<a href="#type-double">double</a> <strong>forceLaneDividers</strong> <em>set a nonzero number to keep the skin from ignoring them if there aren't many of them</em>
<a href="#type-double">double</a> <strong>trackheight</strong> <em>-- ask for extra vertical empty space above the track floor</em>
<a href="#type-double">double</a> <strong>skinnyGreyBlocks</strong> <em>-- set to 0 if your grey blocks have the same hitbox as normal blocks, any other number if they have a skinny hitbox like the ones in <a href="mods.html#GameplaySettings" class=func>GameplaySettings</a>{<strong>automatic_traffic_collisions</strong> = true}</em></code></pre>
<p><em>(<code><a href="#type-bool">bool</a></code> properties weren't supported in the past and I haven't yet updated my skins, but I will add support eventually.)</em></p>
<p>As always, <a href="index.html#contact">contact me</a> if you have something to add.</p>
<ul class="seealso">
	<li><a href="mods.html#SetSkinProperties">SetSkinProperties</a></li>
</ul>


<h2 id="GetModeName"><a href="#type-string">string</a> GetModeName()</h2>
<p>Gets the folder name of the current mod, converted to lowercase.</p>


<h2 id="GetTrafficSpeedRatio"><a href="#type-float">float</a> GetTrafficSpeedRatio()</h2>
<p>Gets the value set by <code><a href="mods.html#GameplaySettings" class=func>GameplaySettings</a>{trafficcompression}</code>. The default is <code>0.65</code>.</p>


<h2 id="GetQualityLevel"><a href="#type-int">int</a> GetQualityLevel()</h2>
<p>Returns <code><a href="https://www.lua.org/manual/5.1/manual.html#pdf-math.min" class="func">math.min</a>(3, <a href="#GetQualityLevel4" class="func">GetQualityLevel4</a>())</code></p>


<h2 id="GetQualityLevel4"><a href="#type-int">int</a> GetQualityLevel4()</h2>
<p>Returns the <a href="https://docs.unity3d.com/Documentation/ScriptReference/QualitySettings.GetQualityLevel.html">Unity quality level</a> plus 1.</p>


<h2 id="GetAlbumArtPalette"><a href="#type-color">color</a><a href="#type-array">[]</a> GetAlbumArtPalette{}</h2>
<pre><code><a href="#type-int">int</a> <strong>mincount</strong> = 3
<a href="#type-int">int</a> <strong>maxcount</strong> = 5</code></pre>
<p>Color format: <code>{r=0-1, g=0-1, b=0-1, a=1}</code></p>
<p>Reads the <code><a href="magic-literals.html#special-textures">&lt;ALBUMART&gt;</a></code> texture with a tool named Color Thief and produces colors that presumably came from that image. If there is no album art it generates <code>mincount</code> random colors. (Each color is just 3 random floats between 0.0 and 1.0 inclusive. There is no attempt to avoid greys or produce a tasteful palette.)</p>
<p>According to Dylan: It picks out prominent colors from the album art image. Less colorful images return less colors and if you force it to return more with a high <code>mincount</code> the colors will have less variation.</p>
<p><code>mincount</code> and <code>maxcount</code> used to be bugged but it is fixed now.</p>


<h2 id="IsVideoscreenUsed"><a href="#type-bool">bool</a> IsVideoscreenUsed()</h2>
<p>True if the current song is a video.</p>
<ul class="seealso">
	<li><a href="#SetVideoScreenTransform">SetVideoScreenTransform</a></li>
</ul>




<h1 id="customization-functions">Customization Functions</h1>
<p><a href="https://stackoverflow.com/questions/686931/are-curly-brackets-used-in-lua">In case you aren't familiar with Lua syntax</a>, a function name followed by braces is shorthand for calling the function with a single argument which is a table. So, <code>Foo{bar=1}</code> and <code>Foo({bar=1})</code> are equivalent.</p>


<h2 id="SetScene">SetScene{}</h2>
<pre><code><em>-- if this is the <a href="#script-execution">first run</a></em>
	<a href="#type-float">float</a> <strong>maxAllowedTrackHeight</strong> = 10000000000
	<a href="#type-float">float</a> <strong>camStaticZone</strong> = 0
	<em>-- if this is a dedicated skin (included with the mod)</em>
		<em>-- Forced to be "straight" if mod sets <code><a href="mods.html#GameplaySettings" class=func>GameplaySettings</a>{<strong>sideview</strong>=true}</code>.</em>
		<a href="#type-string">string</a>/<a href="#type-table">table</a> <strong>twistmode</strong> ?= nil or "cork" or "straight" or "straightish" or "straightisher" or "straightishest" or "straightishest_flatishest" or "straightishest_flatish" or "straightisher_flatish" or "straight_flat50" or "straight_flat25" or "straight_flatish" or "straight_flatisher" or "straight_flatishest" or "straight_flat" or "cork_flatish" or "circle" or "default" or table {
			<em>-- Cork twist mode.</em>
			<a href="#type-float">float</a> <strong>curvescaler</strong> = 1
			<a href="#type-float">float</a> <strong>steepscaler</strong> = 1
		}
	<em>-- end</em>
	<a href="#type-bool">bool</a> <strong>water</strong> = true <em>-- When setting this to false, water is permanently <a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/GameObject.SetActive.html">deactivated</a>. Setting it to true again will set a flag that water is in use without actually re-activating the water surface object.</em>
	<a href="#type-int">int</a> <strong>numvisiblewaterchunks</strong> = -1 <em>-- Any value 1 or less is replaced with 4 or 8, depending on how much graphics memory is available.</em>
	<a href="#type-bool">bool</a> <strong>towropes</strong> ?= false <em>-- Wakeboard mode effect that connects <strong>pullermodel</strong> to <a href="#SetPlayer">SetPlayer</a>{surfer={arms}}.</em>
	bool usebackgroundcamera = true <em>-- Once set to false it can't be re-enabled.</em>
<em>-- end</em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a> <strong>waterclones</strong> = nil
<a href="#type-color">color</a> <strong>skywirecolor</strong> ?= nil
<a href="#type-string">string</a> <strong>minimap_colormode</strong> = "track" or "white" or "black" or "greyscale"
bool use_intro_swoop_cam = true <em>-- Only alters the camera behavior; doesn't change the interval of silence before the song.</em>
<a href="#type-int">int</a> <strong>glowpasses</strong> ?= 4 <em>-- Glow changes take effect next frame. If a pass count less than 1 is applied, the glow effect will be permanently disabled. Passes greater than 30 become 30. The glow "intensity" is always 1.5.</em>
<a href="#type-float">float</a> <strong>glowspread</strong> ?= 0.5 <em>-- Values are clamped to the range 0.5 to 1.0.</em>
<a href="#type-float">float</a> <strong>radialblur_strength</strong> ?= 1.0 <em>-- Changes will be applied on the next frame. 0.0 disables the effect. The actual radial blur strength per-frame is <code>math.min(1.5, math.max(0, current_camera_bias - 0.6) * 5) * fif(is_jumping, 0, 1) * <strong>radialblur_strength</strong></code></em>
bool hide_default_background_verticals ?= false <em>-- Objects that draw on top of other objects in the background <a href="magic-literals.html#cameras">camera</a>. This was used to add a special effect to the <a href="glossary.html#skywires">skywires</a> but tends to interfere with other uses of the background camera. Once hidden they cannot be un-hidden.</em>
float crease_strength ?= 0 <em>-- Cannot be set back to 0 once changed.</em>
<a href="#type-bool">bool</a> <strong>dynamicFOV</strong> ?= false <em>-- While true, the setting changed by <a href="#SetPlayer" class=func>SetPlayer</a>{<strong>fov</strong>} is ignored.</em>
float closecam_near ?= ? <em>-- Changes the near clip plane of the close <a href="magic-literals.html#cameras">camera</a> (<a href="glossary.html#layer">layers</a> <a href="magic-literals.html#layer-14">14</a> and <a href="magic-literals.html#layer-15">15</a>).</em>
float closecam_far ?= 50
<em>-- if <strong>airdebris_count</strong> ~= nil or <strong>airdebris_density</strong> ~= nil or <strong>airdebris_particlesize</strong> ~= nil or <strong>airdebris_fieldsize</strong> ~= nil or <strong>airdebris_layer</strong> ~= nil</em>
	<a href="#type-int">int</a> <strong>airdebris_count</strong> = 500 <em>-- "Sprites per chunk".</em>
	<a href="#type-int">int</a> <strong>airdebris_density</strong> = 10 <em>-- "Sprites each ring".</em>
	float <strong>airdebris_particlesize</strong> = 1 <em>-- "Particle scaler".</em>
	float <strong>airdebris_fieldsize</strong> <em>-- "Cell size".</em>
	int <strong>airdebris_layer</strong> = 11
<em>-- end</em>
string airdebris_texture ?= ? <em>-- Texture options: Clamp, Use Mipmaps.</em>
<a href="#type-color">color</a> <strong>watertint</strong> ?= ?
bool widewater ?= false <em>-- Water width is 11.25 normally or 16.25 wide. When turned off, width is not changed back to 11.25 but water simulation behavior does change back.</em>
<a href="#type-float">float</a> <strong>minwaterrandomdarkness</strong> ?= 0.5 <em>-- Individual water cubes will be tinted to a random greyscale color between this and 1.</em>
<a href="#type-int">int</a> <strong>watertype</strong> = 0 <em>-- Changes the water shader. Type 1 (default): <a href="shaders.html#shader-GpuOffsetCubes">GpuOffsetCubes</a>, type 2: <a href="shaders.html#shader-GpuOffsetCubesNoLines">GpuOffsetCubesNoLines</a></em>
<a href="#type-bool">bool</a> <strong>watertint_highway</strong> = false <em>-- Water color changes to the current highway color automatically. If enabled, only the alpha of <strong>watertint</strong> will be used.</em>
<a href="#type-address">address</a> <strong>watertexture</strong> ?= ? <em>-- Texture options: Clamp, No Mipmaps.</em>
<a href="#type-bool">bool</a> <strong>usecubewater</strong> ?= true <em>-- When false, water will be <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Behaviour-enabled.html">disabled</a> after the skin loads.</em>
<a href="#type-bool">bool</a> <strong>usedefaultrails</strong> ?= false
<a href="#type-bool">bool</a> <strong>fogenabled</strong> = false <em>-- Enables or disables fog. Also sets <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/FogMode.html">UnityEngine.FogMode.Linear</a> when true.</em>
<a href="#type-color">color</a> <strong>fogcolor</strong> ?= ?
<a href="#type-float">float</a> <strong>fogdensity</strong> ?= ? <em>-- <a href="https://docs.unity3d.com/Documentation/ScriptReference/RenderSettings-fogDensity.html">unused</a> in this fog mode</em>
<a href="#type-float">float</a> <strong>fogstart</strong> ?= ?
<a href="#type-float">float</a> <strong>fogend</strong> ?= ?
bool fog_allowcolorshiftwhenjupming = true <em>-- Temporarily overrides fog settings (on: true, color: highwaycolor * 0.6, mode: ExponentialSquared) at the start of jumps greater than 1 second and restores "normal" settings after the jump. "Normal" settings are determined by checking the fog settings once, on gameplay start, so you may need to turn this off if doing your own dynamic fog effects.</em>
<a href="#type-color">color</a>/<a href="#type-string">string</a> <strong>ambientlight</strong> = {51,51,51,255} or "highway" or "highwayinverted" <em>-- Changes <a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/RenderSettings-ambientLight.html">RenderSettings.ambientLight</a>. Accessible in shaders via <a href="https://docs.unity3d.com/2017.4/Documentation/Manual/SL-UnityShaderVariables.html">UNITY_LIGHTMODEL_AMBIENT</a>. The dynamic color setter enabled by the string settings cannot be switched off once enabled, but setting the constant color every frame may be enough to override it.</em>
<a href="#type-bool">bool</a> <strong>useblackgrid</strong> ?= true
<a href="#type-string">string</a> <strong>pullermodel</strong> ?= ? <em>-- The wakeboard mode "boats" that connect to <strong>towropes</strong> and <a href="#SetWake">SetWake</a>.</em></code></pre>

<h3 id="SetScene-water">Water</h3>
<p>Skins have only limited control over the water effect:</p>
<ul>
<li>Shader: <a href="shaders.html#shader-GpuOffsetCubes">GpuOffsetCubes</a> (<code>watertype = 1</code>), <a href="shaders.html#shader-GpuOffsetCubesNoLines">GpuOffsetCubesNoLines</a> (<code>watertype = 2</code>)
	<br>Both shaders use the standard "transparent" <a href="https://docs.unity3d.com/2017.3/Documentation/Manual/SL-Blend.html">blending mode</a>: <code>Blend SrcAlpha OneMinusSrcAlpha</code>
	<br>Here is a reverse-engineered snippet from the end of the <a href="shaders.html#shader-GpuOffsetCubes">GpuOffsetCubes</a> pixel shader to show how its color and alpha is determined:
	<pre class="NppCg">half4 color = tex2d(_MainTex, vertex.texcoord.xy) * _Color * vertex.color;
half4 body = color * vertex.texcoord.z * 10;
return register0.x == 0 ? body : half4(color.xyz, 0.01);</pre>
</li>
<li>Texture: <code>watertexture</code> is loaded with "clamp" wrapping and no mipmaps. I have not found any official documentation on the significance of different areas of the texture and haven't studied it.
	<br>If a mod enables jump markers, a 3 pixel thick opaque white stripe will be drawn horizontally through the texture before it's sent to the GPU. The center of the line is calculated to be offset <code>(height * 0.37)</code> from the bottom of the image. Therefore, by varying the resolution of the image, you could change how thick the line is from the shader's perspective.</li>
<li>Color: <code>watertint</code> and <code>watertint_highway</code> directly control the <code>_Color</code> of the material.</li>
<li>Vertex Color: <code>minwaterrandomdarkness</code> produces random shades of grey in the vertex color. All 8 vertices of each cube are the same color.</li>
<li>Layer: <a href="magic-literals.html#layer-13">13</a> (foreground)</li>
<li>Renderqueue of the front-most water chunk is 2997 and all additional chunks are lower numbers, in order. <a href="magic-literals.html#render-queue">Normal transparent objects are at 3000</a>. So if you are using the default <code>numvisiblewaterchunks</code> setting the range to expect water in is 2990-2997.</li>
<li>The formula for the default setting of <code>numvisiblewaterchunks</code> is <code>fif(<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/SystemInfo-graphicsMemorySize.html">gpu_megabytes</a> > 3 * (#<a href="#GetTrack">GetTrack</a>() / 84), 4, 8)</code>. The debug console will have "Prebuilding 84-ring-size wave chunks" if the default is 4 and "Live building 21-ring-size wave chunks" if it is 8. (There is no way for Lua to change the rendering mode mentioned in those console lines.) Since this setting appears to have significant performance implications, it is probably best to leave it alone in most graphics quality modes unless it is causing your skin problems.</li>
<li><code>waterclones</code> lists relative world-space coordinates to render the water surface extra times in different locations. There is no provision for giving them a different rotation, shape, or material. This can't be used to reliably do much unless used with mods that have some limitation on track shape.</li>
<li><code>widewater</code> widens water from 11.25 to 16.25 and alters water behavior.</li>
<li>I don't know what the difference between <code>water</code> and <code>usecubewater</code> is aside from that one "<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/GameObject.SetActive.html">deactivates</a>" water and the other "<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Behaviour-enabled.html">disables</a>" it. If you aren't using water, setting both to false might be best for performance. (Untested.)</li>
<li>Other water-related settings:
	<ul>
	<li><code><a href="#SetWake">SetWake</a></code></li>
	<li><pre><a href="#SetPlayer">SetPlayer</a>{
	vehicle = { use_water_rooster, roostercolor, water_rooster_z_offset },
	airvehicle,
	watervehicle,
	surfer = { use_water_rooster, roostercolor, water_rooster_z_offset },
}</pre></li>
	<li><code><a href="#CreateLight">CreateLight</a>{floatonwaterwaves}</code></li>
	<li><code><a href="#CreateObject">CreateObject</a>{floatonwaterwaves}</code></li>
	<li><code><a href="#SetBlocks">SetBlocks</a>{colorblocks = {float_on_water}}</code></li>
	<li><code><a href="#BatchRenderEveryFrame">BatchRenderEveryFrame</a>{waterfloat}</code></li>
	</ul>
</li>
</ul>


<h2 id="SetTrackColors">SetTrackColors(<a href="#type-color">color</a><a href="#type-array">[]</a>)</h2>
<p>Set the sequence of colors that get turned into the "highway colors" gradient. The first color is the low intensity color.</p>


<h2 id="SetBlockColors">SetBlockColors(<a href="#type-color">color</a><a href="#type-array">[]</a>)</h2>
<p>Block colors used by puzzle gamemodes.</p>


<h2 id="SetShieldColors">SetShieldColors(<a href="#type-color">color</a><a href="#type-array">[3]</a>)</h2>
<p>One of the Audioshield things present in Audiosurf 2. I haven't checked if these colors get used by anything.</p>
<p>Only the first 3 colors in the array will be used. If you supply less than 3 values, the missing values will be 50% grey. Pass a <code>nil</code> array to set default colors: </p>
<pre class=LuaCode><code>SetShieldColors(nil)
<em>-- same as</em>
SetShieldColors{
	{53, 141, 255},
	{255, 52, 0},
	{103, 53, 176},
}</code></pre>


<h2 id="SetSparkColors">SetSparkColors(<a href="#type-color">color</a><a href="#type-array">[3]</a>)</h2>
<p>Exactly the same as <code><a href="#SetShieldColors" class=func>SetShieldColors</a></code>, including the default values, but sets the "spark colors".</p>


<h2 id="SetOrbColors">SetOrbColors(<a href="#type-color">color</a><a href="#type-array">[3]</a>)</h2>
<p>Exactly the same as <code><a href="#SetShieldColors" class=func>SetShieldColors</a></code>, including the default values, but sets the "orb colors".</p>


<h2 id="LoadSounds">LoadSounds(<a href="#type-dict">{</a><a href="#type-string" class=func>string</a><a href="#type-dict">=</a><a href="#type-address">address</a><a href="#type-dict">}</a>)</h2>
<p>Adds or replaces a named sound effect, which can be invoked by Audiosurf 2 or <a href="mods.html#PlaySound">mods</a>. Names are case-insensitive.</p>

<h3 id="LoadSounds-builtin">Built-in Sounds</h3>
<ul>
	<li>crowdroar</li>
	<li>hit</li>
	<li>hitblack</li>
	<li>hitgrey</li>
	<li>hitgreypro</li>
	<li>jump</li>
	<li>jumpfail</li>
	<li>jumploop</li>
	<li>landcrash</li>
	<li>landsafe</li>
	<li>levelup</li>
	<li>matchblack</li>
	<li>matchhuge</li>
	<li>matchlarge</li>
	<li>matchmedium</li>
	<li>matchsmall</li>
	<li>musiclost (maybe)</li>
	<li>overfill</li>
	<li>overfillwarning</li>
	<li>rail</li>
	<li>trickdone</li>
	<li>trickfail</li>
</ul>

<h3 id="LoadSounds-used">Sounds Used by Game Functions</h3>
<ul>
	<li>crowdroar</li>
	<li>hit (Pitch shifts from 100% to 300% as the number of filled puzzle cells increases from 0 to 21.)</li>
	<li>hitgrey</li>
	<li>hitgreypro</li>
	<li>jump</li>
	<li>jumpfail</li>
	<li>jumploop (air seconds)</li>
	<li>landcrash</li>
	<li>landsafe (if air seconds &lt; 1.2 then volume = 0.1)</li>
	<li>levelup</li>
	<li>levelup</li>
	<li>matchhuge</li>
	<li>matchlarge</li>
	<li>matchmedium</li>
	<li>matchsmall</li>
	<li>overfill</li>
	<li>overfillwarning</li>
	<li>rail (if air seconds &lt; 1.2 then volume = 0.2)</li>
	<li>trickdone</li>
	<li>trickfail</li>
</ul>


<h2 id="SetVideoScreenTransform">SetVideoScreenTransform(<a href="#type-transform">transform</a>)</h2>
<p>Change the position of the video screen, if one exists.</p>
<ul class="seealso">
	<li><a href="#IsVideoscreenUsed">IsVideoscreenUsed</a></li>
</ul>


<h2 id="SetPlayer">SetPlayer{}</h2>
<pre><code><a href="#type-float">float</a> <strong>fov</strong> = 90
bool cameraortho = false <em>-- orthographic cameras</em>
<a href="#type-bool">bool</a> <strong>cameraignoreslope</strong> = false
<a href="#type-float">float</a> <strong>cameraHeightTrackingRatio</strong> = 1
<a href="#type-string">string</a> <strong>cameramode</strong> = "first" or third" or "first_jumpthird" or "first_trickthird" or "third_trickjumpthird" <em>-- case insensitive. throws an exception if it is a string that doesn't match</em>
string cameradynamics = null or "high" <em>-- "use extra dynamic camera", adjust the camera "bias"</em>
<a href="#type-table">table</a> <strong>camfirst</strong> ?= nil or {
	<a href="#type-vector3">vector3</a> <strong>pos</strong> = {0,0,0} <em>-- default if camfirst is nil: {1, 2.7, 3.50475}</em>
	<a href="#type-vector3">vector3</a> <strong>rot</strong> = {0,0,0} <em>-- default if camfirst is nil: {20.49113, 0, 0}</em>
	<a href="#type-float">float</a> <strong>strafefactor</strong> ?= 1
	<a href="#type-float">float</a> <strong>puzzleoffset</strong> ?= 0 <em>-- "ring offset"</em>
}
<a href="#type-table">table</a> <strong>camthird</strong> ?= nil or { <em>-- pos/rot is called "near" and pos2/rot2 "far"</em>
	<a href="#type-vector3">vector3</a> <strong>pos</strong> = {0,0,0} <em>-- default if camthird is nil: {1, 3.9, -0.23}</em>
	<a href="#type-vector3">vector3</a> <strong>rot</strong> = {0,0,0} <em>-- default if camthird is nil: {20.49113, 0, 0}</em>
	<a href="#type-float">float</a> <strong>strafefactor</strong> ?= 0.5
	<em>-- if pos2 is nil, pos2/rot2/strafefactorFar are set to the current values of pos/rot/strafefactor and your settings for rot2/strafefactorFar are ignored</em>
	<a href="#type-vector3">vector3</a> <strong>pos2</strong> = {0,0,0} <em>-- default if camthird is nil: {1, 1.8, -3.17}</em>
	<a href="#type-vector3">vector3</a> <strong>rot2</strong> = {0,0,0} <em>-- default if camthird is nil: {25.836, 0, 0}</em>
	<a href="#type-float">float</a> <strong>strafefactorFar</strong> ?= 1
	<a href="#type-float">float</a> <strong>transitionspeed</strong> ?= 1 <em>-- "smooth bias speed"</em>
	<a href="#type-float">float</a> <strong>puzzleoffset</strong> ?= 0 <em>-- "ring offset close"</em>
	<a href="#type-float">float</a> <strong>puzzleoffset2</strong> ?= 0 <em>-- "ring offset far"</em>
}
<em>-- First run only:</em>
<a href="#type-table">table</a> <strong>vehicle</strong> = ? or { <em>-- strange things may happen if this is omitted during the first run</em>
	<a href="#type-gameobject">gameobject</a> <strong>*</strong> <em>-- all of the variables from gameobject are included directly inside this table</em>
	bool reflect ?= false <em>-- cannot be disabled once set to true</em>
	<a href="#type-float">float</a> <strong>min_hover_height</strong> = 0
	<a href="#type-float">float</a> <strong>max_hover_height</strong> = 0
	<a href="#type-bool">bool</a> <strong>use_water_rooster</strong> = true <em>-- cannot be re-enabled once set to false</em>
	<a href="#type-float">float</a> <strong>rollscaler</strong> = -1
	float panscaler = 0
	<a href="#type-bool">bool</a> <strong>smooth_tilting</strong> = false
	<a href="#type-float">float</a> <strong>smooth_tilting_speed</strong> = 10
	<a href="#type-float">float</a> <strong>smooth_tilting_max_offset</strong> = -20
	<a href="#type-float">float</a> <strong>water_rooster_z_offset</strong> = -1.04
	<a href="#type-color">color</a> <strong>roostercolor</strong> = {0.133, 0.22, 0.486, 1}
}
<a href="#type-gameobject">gameobject</a> <strong>airvehicle</strong> ?= nil
<a href="#type-gameobject">gameobject</a> <strong>watervehicle</strong> ?= nil
<a href="#type-table">table</a> <strong>surfer</strong> ?= nil or {
	<a href="#type-bool">bool</a> <strong>use_water_rooster</strong> = true
	<a href="#type-color">color</a> <strong>roostercolor</strong> = {0.133, 0.22, 0.486, 1}
	<a href="#type-float">float</a> <strong>water_rooster_z_offset</strong> ?= -1.04
	<a href="#type-gameobject">gameobject</a> <strong>arms</strong> ?= ? or {
		<em>-- The object will be completely created in the usual way, and then some things will be shallow copied to the real object.</em>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/MeshFilter-mesh.html" class=type>UnityEngine.MeshFilter.mesh</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-sharedMaterial.html" class=type>UnityEngine.Renderer.sharedMaterial</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer.html" class=type>UnityEngine.Renderer</a>.<span title="Compatibility shim: shadowCastingMode = castShadows ? ShadowCastingMode.On : ShadowCastingMode.Off">castShadows</span>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-receiveShadows.html" class=type>UnityEngine.Renderer.receiveShadows</a>
	}
	<a href="#type-gameobject">gameobject</a> <strong>leg</strong> ?= <strong>arm</strong> or {
		<em>-- The object will be completely created in the usual way, and then some things will be shallow copied to the real object.</em>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/MeshFilter-mesh.html" class=type>UnityEngine.MeshFilter.mesh</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-sharedMaterial.html" class=type>UnityEngine.Renderer.sharedMaterial</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer.html" class=type>UnityEngine.Renderer</a>.<span title="Compatibility shim: shadowCastingMode = castShadows ? ShadowCastingMode.On : ShadowCastingMode.Off">castShadows</span>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-receiveShadows.html" class=type>UnityEngine.Renderer.receiveShadows</a>
	}
	<a href="#type-gameobject">gameobject</a> <strong>body</strong> ?= ? or {
		<em>-- The object will be completely created in the usual way, and then some things will be shallow copied to the real object.</em>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/MeshFilter-mesh.html" class=type>UnityEngine.MeshFilter.mesh</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-sharedMaterial.html" class=type>UnityEngine.Renderer.sharedMaterial</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer.html" class=type>UnityEngine.Renderer</a>.<span title="Compatibility shim: shadowCastingMode = castShadows ? ShadowCastingMode.On : ShadowCastingMode.Off">castShadows</span>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-receiveShadows.html" class=type>UnityEngine.Renderer.receiveShadows</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/GameObject-layer.html" class=type>UnityEngine.GameObject.layer</a> <em>-- Default: <a href="magic-literals.html#layers">14</a></em>
	}
	<a href="#type-gameobject">gameobject</a> <strong>board</strong> ?= ? or {
		<em>-- The object will be completely created in the usual way, and then some things will be shallow copied to the real object.</em>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/MeshFilter-mesh.html" class=type>UnityEngine.MeshFilter.mesh</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-sharedMaterial.html" class=type>UnityEngine.Renderer.sharedMaterial</a>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer.html" class=type>UnityEngine.Renderer</a>.<span title="Compatibility shim: shadowCastingMode = castShadows ? ShadowCastingMode.On : ShadowCastingMode.Off">castShadows</span>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-receiveShadows.html" class=type>UnityEngine.Renderer.receiveShadows</a>
	}
	<a href="#type-gameobject">gameobject</a> <strong>towrope_node</strong> ?= ? or {
		<em>-- The object will be completely created in the usual way, and then some things will be shallow copied to the real object.</em>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-sharedMaterial.html" class=type>UnityEngine.Renderer.sharedMaterial</a>
	}
	<a href="#type-gameobject">gameobject</a> <strong>towboat</strong> ?= ? or {
		<em>-- The object will be completely created in the usual way, and then some things will be shallow copied to the real object.</em>
		<a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Renderer-sharedMaterial.html" class=type>UnityEngine.Renderer.sharedMaterial</a> <em>-- <a href="#type-materialcolor">materialcolor</a> dynamic colors will be disabled. Maybe because it is going to apply its own dynamic coloring. <a href="#UpdateMaterial" class=func>UpdateMaterial</a> should still work.</em>
	}
}
<em>-- End of first run only</em></code></pre>


<h2 id="SetBackgroundColor">SetBackgroundColor(<a href="#type-color">color</a>)</h2>
<pre class=LuaCode><code>SetBackgroundColor{0, 127, 255} <em>-- #007FFF</em></code></pre>
<p>Sets the background color of the "<a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/Camera-main.html">main camera</a>", which will permanently change the camera mode to clear whatever was drawn by previous cameras. I don't know which camera is the main camera.</p>
<ul class="seealso">
	<li><a href="#SetSkybox">SetSkybox{}</a></li>
	<li><a href="magic-literals.html#layers">Layers</a></li>
</ul>


<h2 id="SetSkybox">SetSkybox{}</h2>
<pre><code><em>-- Some things in this list have the same name because that name can contain any one of the listed types.</em>
<a href="#type-materialcolor">materialcolor</a> <strong>color</strong> ?= ? <em>-- Can be used with <strong>skysphere</strong>, <a href="#type-string">string</a> <strong>sky</strong>, and <strong>custom</strong>.</em>
<a href="#type-string">string</a> <strong>sky</strong> = nil <em>-- Loads an embedded skybox material. Internally loads a resource named like "Skyboxes/<strong>sky</strong>/<strong>sky</strong>". (TODO: find a way to list them.)</em>
<a href="#type-table">table</a> <strong>sky</strong> = nil or {
	<em>-- This table controls <a href="#silver-lining">Silver Lining</a>.</em>
	<a href="#type-int">int</a> <strong>month</strong> = 2.0
	<a href="#type-int">int</a> <strong>hour</strong> = 12.0
	<a href="#type-int">int</a> <strong>minute</strong> = 0.0
	<a href="#type-double">double</a> <strong>cloudmaxheight</strong> = 1.1 <em>-- Cumulus clouds. 1.0 is the top of the level (<a href="lib/track_bounds.html">track boundaries</a>), -1.0 is the bottom, and 0 is the center.</em>
	<a href="#type-double">double</a> <strong>cloudminheight</strong> = -1.1 <em>-- These two settings are ignored if <strong>cloudminheight</strong> and <strong>cloudmaxheight</strong> are specified.</em>
	<a href="#type-double">double</a> <strong>clouddensity</strong> = 0.6 <em>-- 0 or less disables cumulus clouds. setting this too high causes severe graphical glitches and lag.</em>
	<a href="#type-double">double</a> <strong>cirrusposition</strong> = 0.0 <em>-- 0 disables cirrus clouds. Positive and negative numbers are offset from the top and bottom of the <a href="lib/track_bounds.html">track</a>, respectively.</em>
	bool showsun = true
	vector3 cloudboundsmin = <em>-- By default <a href="glossary.html#coordinate">Y</a> uses <strong>cloudminheight</strong>, <a href="glossary.html#coordinate">XZ</a> is <a href="https://www.lua.org/manual/5.1/manual.html#pdf-math.max" class=func>max</a>(80000, <a href="lib/track_bounds.html">track_bounds</a>.min.XZ * 2).</em>
	vector3 cloudboundsmax = <em>-- By default <a href="glossary.html#coordinate">Y</a> uses <strong>cloudmaxheight</strong>, <a href="glossary.html#coordinate">XZ</a> is <a href="https://www.lua.org/manual/5.1/manual.html#pdf-math.max" class=func>max</a>(80000, <a href="lib/track_bounds.html">track_bounds</a>.max.XZ * 2).</em>
	<a href="#type-bool">bool</a> <strong>flare</strong> = true <em>-- Once turned off it cannot be turned back on. <a href="#SetSkybox-conditions">Unlike the other settings</a>, this one is guaranteed to take effect.</em>

	<a href="#type-double">double</a> <strong>latitude</strong> ?= 42
	<a href="#type-double">double</a> <strong>longitude</strong> ?= 185.6
	<a href="#type-bool">bool</a> <strong>useProceduralAmbientLight</strong> ?= true
	<a href="#type-bool">bool</a> <strong>useProceduralSunLight</strong> ?= true
	vector3 windspeed ?= {10, 0, 10}
}
<a href="#type-dict">{</a><a href="#type-string" class=func>string</a><a href="#type-dict">=</a><a href="#type-address">address</a><a href="#type-dict">}</a> <strong>custom</strong> = nil <em>-- Textures (clamp, mipmaps, bilinear). Names to use: _BackTex _DownTex _FrontTex _LeftTex _RightTex _UpTex</em>
<em>-- IF <strong>custom</strong> is a table these values will be read as nil:</em>
<a href="#type-address">address</a> <strong>skysphere</strong> ?= ? or "default" or (...) <em>-- Texture (repeat, no mipmaps, bilinear). "default" will leave the texture at its current setting but allow you to change the other settings. This setting is only applied on the first run but you must supply a string whenever you want to change the other skysphere settings.</em>
<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>skysphere</strong> ?= ?
string skyscreen <em>-- Shader name.</em>
<a href="#type-UnityEngine.Material">UnityEngine.Material</a> skyscreen
int skyscreenlayer = <a href="magic-literals.html#layers">18</a> <em>-- If the background camera is disabled, it uses layer 13 instead of your setting.</em>
vector3 skyScreen_TrackOffset = nil <em>-- A position in <a href="glossary.html#node-space">node space</a>.</em>
vector3 skyScreen_FixedTrackOffset = nil
<em>-- END IF</em>
<em>-- IF <strong>skysphere</strong> is a string:</em>
rotation sphererot ?= ? <em>-- If you want to change this setting on the <a href="#type-UnityEngine.Material">UnityEngine.Material</a> version of <strong>skyscreen</strong>, call SetSkybox a second time with <strong>skyscreen</strong> = "default".</em>
string emissionmap ?= ? <em>-- Texture (clamp, no mipmaps, bilinear).</em>
<a href="#type-vector2">vector2</a> <strong>texturescale</strong> ?= ?
<a href="#type-vector2">vector2</a> <strong>textureoffset</strong> ?= ?
<em>-- END IF</em></code></pre>
<ul class="seealso">
	<li><a href="#SetBackgroundColor">SetBackgroundColor{}</a></li>
</ul>

<h3 id="SetSkybox-conditions">Conditions</h3>
<p>If your table does not satisfy at least one of these conditions, <code>SetSkybox</code> will exit early without applying most changes.</p>
<ul>
	<li><code><strong>skyscreen</strong></code> is a <code><a href="#type-string">string</a></code> or Material (and <code><strong>custom</strong></code> is not a <code><a href="#type-table">table</a></code>).</li>
	<li><code><strong>skysphere</strong></code> is a <code><a href="#type-string">string</a></code> or Material (and <code><strong>custom</strong></code> is not a <code><a href="#type-table">table</a></code>).</li>
	<li><code>(<strong>sky</strong> <span title="If not the desired type, will be read as nil.">as</span> <a href="#type-string">string</a>)</code> is different from the last time.</li>
	<li><code><strong>color</strong></code> is a <code><a href="#type-color">color</a></code> and it wasn't last time, or vice versa.</li>
	<li><code><strong>color</strong></code> is a <code><a href="#type-color">color</a></code> and that color is different from last time.</li>
	<li>The keys of <code>(<strong>custom</strong> <span title="If not the desired type, will be read as nil.">as</span> <a href="#type-table">table</a>)</code>, converted to a <code><a href="#type-string">string</a></code>, is different from last time. (Bug: Values used to be included and now they aren't. Adding and removing unused keys should be enough to force it to recognize a difference.)</li>
	<li><code><strong>sky</strong></code> is a <code><a href="#type-table">table</a></code> and it wasn't last time, or vice versa.</li>
	<li>
		<code><strong>sky</strong></code> is a <code><a href="#type-table">table</a></code> and any of these values (or their defaults, if unspecified) are different from the last time:
		<ul>
			<li><code><strong>month</strong></code> (Compared as <code><a href="#type-double">double</a></code> even though the fraction isn't used.)</li>
			<li><code><strong>hour</strong></code> (Compared as <code><a href="#type-double">double</a></code> even though the fraction isn't used.)</li>
			<li><code><strong>minute</strong></code> (Compared as <code><a href="#type-double">double</a></code> even though the fraction isn't used.)</li>
			<li><code><strong>cloudmaxheight</strong></code></li>
			<li><code><strong>cloudminheight</strong></code></li>
			<li><code><strong>clouddensity</strong></code></li>
			<li><code><strong>cirrusposition</strong></code></li>
		</ul>
	</li>
</ul>
<p>The "last time" memory is only updated by successful runs, and all of its variables start at zero/nil. Unspecified values will be remembered as if their defaults were specified.</p>

<h3 id="SetSkybox-combinations">Combining Settings</h3>
<p>If <code><strong>sky</strong></code> is a <code><a href="#type-table">table</a></code> its settings will be applied and will not block any other settings. If it is not a table, <a href="#silver-lining">Silver Lining</a> will be disabled.</p>
<p>
	The following settings are checked in order and if one contains the required type then it will be applied and the settings after it will not be applied.
	<ol>
		<li><code><a href="#type-string">string</a>/<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>skyscreen</strong></code></li>
		<li><code><a href="#type-string">string</a>/<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>skysphere</strong></code></li>
		<li><code><a href="#type-string">string</a> <strong>sky</strong></code></li>
		<li><code><a href="#type-table">table</a> <strong>custom</strong></code></li>
	</ol>
	If any of those 4 settings were present, <code><strong>color</strong></code> will be applied. If you mix <code><strong>skyscreen</strong></code> with one of the other 3, that one will also be applied with a null material because of a spaghetti bug.
</p>

<h3 id="silver-lining">Silver Lining Skybox</h3>
<p><a href="https://forum.unity3d.com/threads/107166-SilverLining-for-Unity-3D-volumetric-clouds-sim-quality-procedural-skies">Silver Lining</a> is highly customizable but AS2 doesn't expose most of the interesting options or even most of the basic options. Here's some of the important locked settings:</p>
<ul>
	<li>year = 2010</li>
	<li>day = 1</li>
	<li>daylightSavingsTime = true</li>
	<li>timeZone = -8.0</li>
	<li>altitude = 0</li>
</ul>
<p>It's not possible to alter these by setting one of the other values by a really big number; it rejects the entire time setting if one of the values is out of range. The daylight savings time setting is active no matter which time of year you specify, so the effective time zone is UTC -7 (pacific daylight time).</p>
<ul class="seealso">
	<li><a href="#UpdateProceduralSky">UpdateProceduralSky{}</a></li>
</ul>

<h3 id="SetSkybox-skysphere"><code><strong>skysphere</strong></code> Skybox</h3>
<pre class=LuaCode><code>SetSkybox{
	color = {1,1,1},
	skysphere = "Sky.jpg",
	texturescale = {1,1},
	textureoffset  = {0,0},
	sphererot = {0,0,0},
	<em>--emissionmap = "SkyGlow.jpg", -- ???</em>
}</code></pre>
<p>I assume this takes a 360 degree "equirectangular" panorama texture.</p>
<ul class="seealso">
	<li><a href="https://www.cgskies.com/">CGSkies</a></li>
	<li><a href="https://duckduckgo.com/?q=free+panorama+sky">Web Search: free panorama sky</a></li>
	<li><a href="https://docs.unity3d.com/2017.4/Documentation/Manual/StandardShaderMaterialParameterEmission.html">Emission</a></li>
</ul>

<h3 id="SetSkybox-custom"><code><strong>custom</strong></code> Skybox</h3>
<pre class=LuaCode><code>SetSkybox{
	color = {1,1,1},
	custom = {
		_FrontTex = "MySkybox/Front.jpg",
		_BackTex  = "MySkybox/Back.jpg",
		_LeftTex  = "MySkybox/Left.jpg",
		_RightTex = "MySkybox/Right.jpg",
		_UpTex    = "MySkybox/Up.jpg",
		_DownTex  = "MySkybox/Down.jpg",
	},
}</code></pre>
<p>A classic 6-sided skybox, also known as a cubemap skybox. They have more consistent texture stretching than a spherical texture. (Converting an existing spheremap to a cubemap is probably pointless unless you're also going to decrease the resolution.)</p>
<ul class="seealso">
	<li><a href="https://docs.unity3d.com/2017.4/Documentation/Manual/class-Skybox.html">Skybox</a></li>
	<li><a href="https://en.wikipedia.org/wiki/Skybox_%28video_games%29">Skybox (video games)</a></li>
	<li><a href="https://jaxry.github.io/panorama-to-cubemap/">Panorama to Cubemap</a></li>
	<li><a href="https://www.cgskies.com/resources_tutorial_transform.php">Panorama Transformations</a></li>
	<li><a href="https://duckduckgo.com/?q=free+skybox+texture">Web Search: free skybox texture</a></li>
</ul>

<h3 id="SetSkybox-skyscreen"><code><strong>skyscreen</strong></code> Skybox</h3>
<p>This is for using procedural skybox shaders. Like a post-processing effect it simply draws your material as a full-screen <a href="glossary.html#quad">quad</a> but does so <a href="glossary.html#render-queue">before</a> the rest of the scene is drawn instead of after it. Shaders made for this purpose change what they draw based on the camera angle.</p>
<ul class="seealso">
	<li><a href="shaders.html#skyscreen">Skyscreen Shaders</a></li>
	<li><a href="skins.html#CreateRail">CreateRail{}</a></li>
	<li><a href="#AddPostEffect">AddPostEffect{}</a></li>
	<li><a href="https://docs.unity3d.com/Manual/shader-skybox-procedural.html">Procedural skybox</a></li>
</ul>


<h2 id="UpdateProceduralSky">UpdateProceduralSky{}</h2>
<pre><code><a href="#type-float">float</a> <strong>latitude</strong> ?= 42
<a href="#type-float">float</a> <strong>longitude</strong> ?= 185.6</code></pre>
<p>Updates parts of the <a href="#silver-lining">Silver Lining</a> skybox without having to deal with <a href="#SetSkybox">SetSkybox</a>.</p>


<h2 id="SetRings">SetRings{}</h2>
<pre><code><a href="#type-bool">bool</a> <strong>shadowcaster</strong> = false
<a href="#type-bool">bool</a> <strong>shadowreceiver</strong> = false
<a href="#type-int">int</a> <strong>layer</strong> = 11
vector3 offset = {0,0,0}
<a href="#type-float">float</a> <strong>size</strong> = 0
<a href="#type-float">float</a> <strong>percentringed</strong> = 0
<a href="#type-bool">bool</a> <strong>useairrings</strong> = true
<em>-- if <strong>material</strong> is UnityEngine.Material</em>
	UnityEngine.Material material
<em>-- else</em>
	<a href="#type-string">string</a> <strong>texture</strong> = nil
	<a href="#type-string">string</a> <strong>shader</strong> = nil <em>-- Built-in shaders only.</em>
<em>-- end</em>
<a href="#type-float">float</a> <strong>airsize</strong> = 0
<em>-- if <strong>airmaterial</strong> is UnityEngine.Material</em>
	UnityEngine.Material airmaterial
<em>-- else</em>
	<a href="#type-string">string</a> <strong>airtexture</strong> = nil
	<a href="#type-string">string</a> <strong>airshader</strong> = nil <em>-- Built-in shaders only.</em>
<em>-- end</em></code></pre>


<h2 id="SetWake">SetWake{}</h2>
<pre><code><a href="#type-float">float</a> <strong>height</strong> = 0.0
<a href="#type-float">float</a> <strong>fallrate</strong> = 0.0
<a href="#type-int">int</a> <strong>layer</strong> = 11
<em>-- if <strong>material</strong> ~= nil</em>
	UnityEngine.Material material
<em>-- else</em>
	<a href="#type-material">material</a> <strong>*</strong> <em>-- All of the variables from <a href="#type-material">material</a> are included directly inside SetWake{}.</em>
<em>-- end</em>
vector3[] offsets ?= {{7.5, 0, 0}, {-7.5, 0, 0}}
<a href="#type-color">color</a>/<a href="#type-string">string</a> <strong>bottomcolor</strong> = "highway" or "highwayinverted" or {1,1,1,1} etc
<a href="#type-color">color</a>/<a href="#type-string">string</a> <strong>topcolor</strong> = "highway" or "highwayinverted" or {1,1,1,1} etc
<a href="#type-bool">bool</a> <strong>extraspray</strong> = false</code></pre>
<p>The <a href="glossary.html#render-queue">render queue</a> is changed to be <a href="magic-literals.html#render-queue">3998</a> (can be changed after calling <code>SetWake</code> to bypass) and <strong>_Color</strong> is forced to be white (cannot be bypassed).</p>

<h3 id="SetWake-diff">Differences Check</h3>
<p>The settings are not applied until a check is run to see if they are different from the current settings, and there are some bugs in this process:</p>
<ul>
	<li>The material is not compared.</li>
	<li>If <code><strong>offsets</strong></code> is omitted it will not be compared.</li>
	<li><code><strong>extraspray</strong></code> is not compared.</li>
</ul>


<h2 id="SetPuzzleGraphics">SetPuzzleGraphics{}</h2>
<pre><code><a href="#type-UnityEngine.Material">UnityEngine.Material</a>/<a href="#type-material">material</a> <strong>puzzlematerial</strong> = nil
<a href="#type-UnityEngine.Material">UnityEngine.Material</a>/<a href="#type-material">material</a> <strong>puzzlematchmaterial</strong> = nil
<a href="#type-UnityEngine.Material">UnityEngine.Material</a>/<a href="#type-material">material</a> <strong>puzzleflyupmaterial</strong> = nil
<a href="#type-bool">bool</a> <strong>usesublayerclone</strong> ?= true</code></pre>


<h2 id="SetBlockFlashes">SetBlockFlashes{}</h2>
<pre><code>address texture ?= ? <em>-- clamped and mipmaps off</em>
float sizescaler ?= 1
float sizescaler_missed ?= 1 <em>-- Until you set this explicitly, changes to <strong>sizescaler</strong> will be mirrored to <strong>sizescaler_missed</strong>.</em>
UnityEngine.Material material ?= ?</code></pre>


<h2 id="SetBlocks">SetBlocks{}</h2>
<pre><code>int maxvisiblecount ?= 30
bool allow_mod_block_scaling = true
<a href="#type-table">table</a> <strong>chainspans</strong> ?= ? or {
	bool hide ?= false
	<em>-- if <strong>material</strong> is UnityEngine.Material</em>
		<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong>
	<em>-- else if <strong>shader</strong> ~= nil</em>
		<a href="#type-material">material</a> <strong>*</strong> <em>-- Create a new material.</em>
	<em>-- else</em>
		<em>-- Modify the default or previously set material.</em>
		<a href="#type-shadercolors">shadercolors</a> <strong>shadercolors</strong> ?= ?
		<a href="#type-address">address</a> <strong>texture</strong> ?= ? <em>-- Uses "repeat", mipmaps on, and bilinear filtering.</em>
	<em>-- end</em>
}
<a href="#type-table">table</a> <strong>colorblocks</strong> ?= ? or {
	<a href="#type-vector3">vector3</a> <strong>scale</strong> ?= ?
	<a href="#type-float">float</a> <strong>height</strong> ?= 0 <em>-- Height offset. This might affect all blocks, not just <strong>colorblocks</strong>.</em>
	<a href="#type-bool">bool</a> <strong>float_on_water</strong> = true <em>-- This might affect all blocks, not just <strong>colorblocks</strong>.</em>
	bool reflect = false
	<em>-- if <strong>gameobject</strong> ~= nil</em>
		<a href="#type-gameobject">gameobject</a> <strong>gameobject</strong> <em>-- <a href="#SetBlocks-prefab">See below about prefabs</a>.</em>
	<em>-- else if <strong>material</strong> is UnityEngine.Material</em>
		<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong>
	<em>-- else if <strong>shader</strong> ~= nil</em>
		<a href="#type-material">material</a> <strong>*</strong> <em>-- Create a new material.</em>
	<em>-- else</em>
		<em>-- Modify the default or previously set material.</em>
		<a href="#type-shadercolors">shadercolors</a> <strong>shadercolors</strong> ?= ?
		<a href="#type-address">address</a> <strong>texture</strong> ?= ? <em>-- Uses "repeat", mipmaps on, and bilinear filtering.</em>
	<em>-- end</em>
	UnityEngine.Mesh/<a href="#type-mesh">mesh</a>/<a href="#type-address">address</a> <strong>mesh</strong> ?= ?
	<em>-- if type(<strong>mesh</strong>) == "string" and type(<strong>meshmorph</strong>) == "string"</em>
		<em>-- In this mode, OBJ file normals will be read from <strong>mesh</strong> and <strong>meshmorph</strong>.</em>
		<a href="#type-address">address</a> <strong>meshmorph</strong>
		<a href="#type-float">float</a> <strong>meshmorphsmoothspeed</strong> ?= 5
		<a href="#type-string">string</a> <strong>meshmorphtype</strong> = "intensity" or "intensitysmooth" or "intensitysmoothfall" or "intensitysmoothrise"
	<em>-- end</em>
}
<a href="#type-table">table</a> <strong>greyblocks</strong> ?= ? or {
	bool reflect ?= false
	<em>-- if <strong>gameobject</strong> ~= nil</em>
		<a href="#type-gameobject">gameobject</a> <strong>gameobject</strong> <em>-- <a href="#SetBlocks-prefab">See below about prefabs</a>.</em>
	<em>-- else if <strong>material</strong> is UnityEngine.Material</em>
		<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong>
	<em>-- else if <strong>shader</strong> ~= nil</em>
		<a href="#type-material">material</a> <strong>*</strong> <em>-- Create a new material.</em>
	<em>-- else</em>
		<em>-- Modify the default or previously set material.</em>
		<a href="#type-shadercolors">shadercolors</a> <strong>shadercolors</strong> ?= ?
		<a href="#type-address">address</a> <strong>texture</strong> ?= ? <em>-- Uses "repeat", mipmaps on, and bilinear filtering.</em>
	<em>-- end</em>
	UnityEngine.Mesh/<a href="#type-mesh">mesh</a>/<a href="#type-address">address</a> <strong>mesh</strong> ?= ?
	<em>-- if type(<strong>mesh</strong>) == "string" and type(<strong>meshmorph</strong>) == "string"</em>
		<em>-- In this mode, OBJ file normals will be read from <strong>mesh</strong> and <strong>meshmorph</strong>.</em>
		<a href="#type-address">address</a> <strong>meshmorph</strong>
		<a href="#type-float">float</a> <strong>meshmorphsmoothspeed</strong> ?= 5
		<a href="#type-string">string</a> <strong>meshmorphtype</strong> = "intensity" or "intensitysmooth" or "intensitysmoothfall" or "intensitysmoothrise"
	<em>-- end</em>
}
<a href="#type-dict">{</a><a href="#type-string" class=func>string</a><a href="#type-dict">=</a><a href="#type-table">table</a><a href="#type-dict">}</a> <strong>powerups</strong> ?= ? or {example = { <em>-- Specifying a powerup will completely discard all of the powerup's previous settings.</em>
	<em>-- if <strong>gameobject</strong> ~= nil</em>
		<a href="#type-gameobject">gameobject</a> <strong>gameobject</strong> <em>-- <a href="#SetBlocks-prefab">See below about prefabs</a>.</em>
	<em>-- else if <strong>material</strong> is UnityEngine.Material</em>
		<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong>
	<em>-- else if <strong>shader</strong> ~= nil</em>
		<a href="#type-material">material</a> <strong>*</strong>
	<em>-- else</em>
		<a href="#type-address">address</a> <strong>texture</strong> ?= nil <em>-- BUG: I don't think this setting branch does anything other than load the texture into the cache and log a "mat is null" error. Uses "repeat", mipmaps on, and bilinear filtering.</em>
	<em>-- end</em>
	UnityEngine.Mesh/<a href="#type-mesh">mesh</a>/<a href="#type-address">address</a> <strong>mesh</strong> <em>-- Unspecified mesh will cause errors later.</em>
	bool reflect = false
	<a href="#type-vector3">vector3</a> <strong>scale</strong> = {1,1,1}
	int blockcolorid = nil
}, ...}</code></pre>

<h2 id="SetBlocks-prefab"><code><strong>gameobject</strong></code> Prefabs</h2>
<p><code><strong>colorblocks</strong></code>, <code><strong>greyblocks</strong></code>, and <code><strong>powerups</strong></code> accept a <code><strong>gameobject</strong></code> setting but only specific aspects of the object <em>and the object's children</em> are referenced when rendering the blocks:</p>
<ul>
	<li>Mesh. (A reference to the object's <a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/MeshFilter.html">MeshFilter</a> component is stored at the time the prefab is provided and the mesh is retrieved from that during each draw call.)</li>
	<li>Material. (Reference to <a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/MeshRenderer.html">MeshRenderer</a> component stored, material retrieved during each draw call.)</li>
	<li>World-space position, used as an offset. (Snapshotted at the time the prefab is provided.)</li>
	<li>Local scale, not accounting for the scale of parents. (Snapshotted.)</li>
	<li>Shadow settings. (Snapshotted. Reflections always have shadows disabled.)</li>
	<li>Layer. (Snapshotted.)</li>
</ul>


<h2 id="OverrideTrackColorForDynamicBlockColors">OverrideTrackColorForDynamicBlockColors(<a href="#type-color">color</a>)</h2>
<p>Overrides the color of "highway color" and "inverse highway color" blocks defined by <code><a href="mods.html#GameplaySettings" class=func>GameplaySettings</a>{ blocktype_highway, blocktype_highwayinverted }</code> If called in <code><a href="#Update">Update</a>()</code>, changes will take effect on the next frame.</p>


<h2 id="CreateRail">CreateRail{}</h2>
<pre><code><a href="#type-globalname">globalname</a> <strong>globalName</strong> = nil <em>-- typeName: "rail"</em>
<a href="#type-vector2">vector2</a> <strong>positionOffset</strong> = {0,0} <em>-- added to every coordinate in crossSectionShape</em>
<a href="#type-vector2">vector2</a><a href="#type-array">[]</a> <strong>crossSectionShape</strong> ?= {
	{-0.5,  0.5},
	{ 0.5,  0.5},
	{ 0.5, -0.5},
	{-0.5, -0.5},
}
<a href="#type-string">string</a> <strong>textureMode</strong> = "repeataround" or "wraparound" or "wraparoundcontinuous" or "none" or "repeataroundreverse" or "wraparoundreverse"
<a href="#type-string">string</a> <strong>colorMode</strong> = "highway" or "highwayinverted" or "static" or "aurora" or "highwayflat" or "trackposition" or "highwayscaledfollowmaxjumpheights" <em>-- The jumpheights option only works inside <code><a href="mods.html#OnSkinLoaded" class=func>OnSkinLoaded</a></code>/<code><a href="mods.html#OnRequestLoadObjects" class=func>OnRequestLoadObjects</a></code>.</em>
<a href="#type-int">int</a> <strong>stretch</strong> = 1 <em>-- referred to internally as "ring spacing"</em>
<a href="#type-color">color</a> <strong>color</strong> ?= {r=0, g=0, b=0, a=0} <em>-- (#1) (<a href="#CreateRail-colorMode">colorMode specific</a>) There are multiple color settings with the same name. This one sets the vertex colors.</em>
<a href="#type-bool">bool</a> <strong>flatten</strong> = false <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>) "use guard rail heights"</em>
<a href="#type-float">float</a><a href="#type-array">[]</a> <strong>perShapeNodeColorScalers</strong> = nil <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>)</em>
<a href="#type-int">int</a> <strong>layer</strong> = 11
<a href="#type-bool">bool</a> <strong>allowfullmaterialoptions</strong> = false
<em>-- if <strong>material</strong> ~= nil or <strong>allowfullmaterialoptions</strong></em>
	<em>-- if <strong>material</strong> is <a href="#type-UnityEngine.Material">UnityEngine.Material</a></em>
		<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong>
	<em>-- else if type(<strong>material</strong>) == 'table'</em>
		<a href="#type-material">material</a> <strong>material</strong>
	<em>-- else</em>
		<a href="#type-material">material</a> <strong>*</strong> <em>-- All of the variables from <a href="#type-material">material</a> are included directly inside this table.</em>
	<em>-- end</em>
<em>-- else</em>
	<a href="#type-string">string</a> <strong>shader</strong> = "<a href="shaders.html#shader-DiffuseVertexColored2">DiffuseVertexColored2</a>" <em>-- If it uses the default, other material settings are also applied. (<a href="#CreateRail-Rail_Default">See below</a>. Specifying that shader explicitly will not apply the default settings.)</em>
	<a href="#type-color">color</a> <strong>color</strong> = white <em>-- (#2) There are multiple color settings with the same name. This one applies to the material.</em>
	<a href="#type-int">int</a> <strong>renderqueue</strong> = 2000 <em>-- <a href="glossary.html#render-queue">Render queue</a>. If you specify a number less than 1 it will use the shader's default.</em>
	<a href="#type-dict">{</a><a href="#type-string" class=func>string</a><a href="#type-dict">=</a><a href="#type-float">float</a><a href="#type-dict">}</a> <strong>shadersettings</strong> ?= nil
	<a href="#type-shadercolors">shadercolors</a> <strong>shadercolors</strong> ?= nil <em>-- setting _Color here will work</em>
	<a href="#type-address">address</a> <strong>texture</strong> ?= nil
<em>-- end</em>
vector3 skyScreen_TrackOffset ?= nil <em>-- see <a href="#skyscreen">here</a></em>
vector3 skyScreen_FixedTrackOffset ?= nil
bool ignoretrackscale = true <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>)</em>
<a href="#type-int">int</a> <strong>nodeskip</strong> ?= 1 <em>-- referred to internally as "ring skip"</em>
bool alphafromintensity ?= false<em> -- (<a href="#CreateRail-colorMode">colorMode specific</a>) Overwrites the vertex color alpha channel with the <a href="glossary.html#normalized-intensity">normalized intensity</a>.</em>
bool texturemirroreddowntrack ?= true
float textureTrackLength ?= 1.0
fload texturetracklength_offset ?= 0.0
<a href="#type-bool">bool</a> <strong>fullfuture</strong> = false <em>-- "render full track"</em>
<a href="#type-bool">bool</a> <strong>futureonly</strong> ?= false <em>-- "stretch to finish"</em>
<a href="#type-bool">bool</a> <strong>calculatenormals</strong> = false
<a href="#type-bool">bool</a> <strong>calculateNormals</strong> = false <em>-- If either of these two is true, normals will be calculated.</em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a> <strong>perShapeNodeNormals</strong> ?= nil <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>) These values are rotated by the node rotation but no other corrections are applied, so you may need to use <strong>ignoretrackscale</strong> to avoid incorrect normals.</em>
<a href="#type-bool">bool</a> <strong>perShapeNodeColorScalersScaleAlpha</strong> = true <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>) Forces the vertex color alpha to always be 100%.</em>
<a href="#type-color">color</a><a href="#type-array">[]</a> <strong>perShapeNodeColors</strong> ?= nil <em>-- static mode only</em>
<em>-- Unused: <a href="#type-int">int</a><a href="#type-array">[]</a> <strong>perShapeNodeFFTInfluenceIndices</strong> ?= nil</em>
<a href="#type-bool">bool</a> <strong>collider</strong> ?= false
vector3[] perTrackNodeScales ?= nil <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>) Scales rail segments individually. If specified and valid, <strong>positionOffset</strong> will be applied after scaling instead of immediately being added to <strong>crossSectionShape</strong>. Array length must match <code>#<a href="#GetTrack" class=func>GetTrack</a>()</code>. Can also use the name <strong>scales</strong>. There is some inconsistency in the effects of this setting when an invalid value is specified, but I didn't notice anything useful.</em>
vector3[][] crossSectionShapeList ?= nil <em>-- (<a href="#CreateRail-colorMode">colorMode specific</a>) Overrides <strong>crossSectionShape</strong> with multiple shapes, one for each <a href="glossary.html#node">track node</a>. If shorter than the track it will repeat. The outer array must be a table but the inner arrays can be <a href="lua.html#LuaInterface">CLI UnityEngine.Vector3[] objects</a>, which will be stored internally without further copying. (This can be used to make large shape lists of mostly reused shape objects with low memory usage.)</em>
<a href="#type-bool">bool</a> <strong>wrapnodeshape</strong> = true <em>-- Connect the first and last points in <strong>crossSectionShape</strong>. Might be turned off if using a two-sided shader or the player will never see that side of the rail.</em>
<a href="#type-bool">bool</a> <strong>shadowcaster</strong> ?= true
<a href="#type-bool">bool</a> <strong>shadowreceiver</strong> ?= true</code></pre>

<h3 id="CreateRail-colorMode"><code><strong>colorMode</strong></code> Setting</h3>
<p>The <code><strong>colorMode</strong></code> setting ostensibly controls the vertex colors of the rail, but in practice each mode has its own copy-pasted code for builing the rail and not all of them use all of the settings. Below are the used settings per mode. (The names in parentheses after the settings names are the internal names of those settings, put there for me to reference when updating this document.)</p>
<dl>
	<dt>highway (HIGHWAYSCALED)</dt>
	<dd>
		<ul>
			<li>Vertex colors: The node's highway color.<code>GetTrack()[...].color</code> (TrackServer.Node.color)</li>
			<li><code>stretch</code> (ringSpacing)</li>
			<li><code>flatten</code> (useGuardrailHeights)</li>
			<li><code>alphafromintensity</code> (intensityInVertexColorAlpha)</li>
			<li><code>crossSectionShape</code> (extrusionPoints)</li>
			<li><code>crossSectionShapeList</code> (shapeList)</li>
			<li><code>ignoretrackscale</code> (ignoreTrackScaler)</li>
			<li><code>OnRequestTrackReshaping()[...].widthscaler</code>/<code>.heightscaler</code> (TrackServer.Node.trackScale)</li>
			<li><code>perTrackNodeScales</code>/<code>scales</code> (ringScales)</li>
			<li><code>perShapeNodeColorScalers</code> (extrusionColorScalers)</li>
			<li><code>perShapeNodeColorScalersScaleAlpha</code> (extrusionColorScalersScaleAlpha)</li>
		</ul>
	</dd>
	<dt>highwayinverted (HIGHWAYSCALEDINVERTED)</dt>
	<dd>Exactly the same as "highway" except it inverts the vertex color.</dd>
	<dt>static (STATIC)</dt>
	<dd>
		<ul>
			<li>Vertex colors: Uses <code><strong>perShapeNodeColors</strong></code> or <code><strong>color</strong></code>(#1).</li>
			<li><code>stretch</code> (ringSpacing)</li>
			<li><code>flatten</code> (useGuardrailHeights)</li>
			<li><code>crossSectionShape</code> (extrusionPoints)</li>
			<li><code>crossSectionShapeList</code> (shapeList)</li>
			<li><code>ignoretrackscale</code> (ignoreTrackScaler)</li>
			<li><code>OnRequestTrackReshaping()[...].widthscaler</code>/<code>.heightscaler</code> (TrackServer.Node.trackScale)</li>
			<li><code>perTrackNodeScales</code>/<code>scales</code> (ringScales)</li>
			<li><code>perShapeNodeColors</code> (extrusionColors)</li>
			<li><code>color</code> (staticModeColor)</li>
			<li><code>perShapeNodeNormals</code> (extrusionNormals)</li>
		</ul>
	</dd>
	<dt>aurora (AURORA)</dt>
	<dd>
		<ul>
			<li>Vertex colors: The node's highway color multiplied by the intensity squared. The intensity it uses is not <a href="glossary.html#normalized-intensity">normalized</a> like <code><a href="#GetTrack" class=func>GetTrack</a>()[i].intensity</code> is. The alpha is multiplied as well. If all the highway colors have an alpha of 1 (the default) then this allows a shader to determine the exact intensity.</li>
			<li><code>stretch</code> (ringSpacing)</li>
			<li><code>flatten</code> (useGuardrailHeights)</li>
			<li><code>crossSectionShape</code> (extrusionPoints)</li>
			<li><code>crossSectionShapeList</code> (shapeList)</li>
			<li><code>ignoretrackscale</code> (ignoreTrackScaler)</li>
			<li><code>OnRequestTrackReshaping()[...].widthscaler</code>/<code>.heightscaler</code> (TrackServer.Node.trackScale)</li>
			<li><code>perTrackNodeScales</code>/<code>scales</code> (ringScales)</li>
			<li><code>perShapeNodeColorScalers</code> (extrusionColorScalers)</li>
		</ul>
	</dd>
	<dt>highwayflat (HIGHWAYFLAT)</dt>
	<dd>
		<ul>
			<li>This special mode completely ignores track node position and rotation. The origin of each extrusion node is simply <code>{0, 0, (node_index - 1) * 3}</code>.</li>
			<li>Vertex colors: The node's highway color.</li>
			<li><code>stretch</code> (ringSpacing)</li>
			<li><code>crossSectionShape</code> (extrusionPoints)</li>
			<li><code>perTrackNodeScales</code>/<code>scales</code> (ringScales)</li>
			<li><code>perShapeNodeColorScalers</code> (extrusionColorScalers)</li>
		</ul>
	</dd>
	<dt>trackposition (TRACKPOS)</dt>
	<dd>
		<ul>
			<li>Vertex colors: The zero-based node index divided by the number of nodes, encoded with <code><a href="https://docs.unity3d.com/2017.4/Documentation/Manual/SL-BuiltinFunctions.html" class=func>EncodeFloatRGBA</a></code>. This is useful in rail <a href="#skyscreen">skyscreen</a> shaders. (I don't understand why he won't just pass this information through UV or <a href="https://docs.unity3d.com/Documentation/ScriptReference/Mesh-uv2.html">UV2</a>.)</li>
			<li><code>stretch</code> (ringSpacing)</li>
			<li><code>flatten</code> (useGuardrailHeights)</li>
			<li><code>crossSectionShape</code> (extrusionPoints)</li>
			<li>
				<code>crossSectionShapeList</code> (shapeList)
				<br>In this mode a non-zero Z coordinate in a shape point will cause it to use an interpolated node based on the current node index plus the Z value. Bug: If you mix zero and non-zero Z values in the same individual cross-section shape, any zeroes after a non-zero will use the non-zero's interpolated node. To work around this, use a small but non-zero Z value (<a href="https://en.wikipedia.org/wiki/Machine_epsilon">not so small that a 32-bit float rounds it to zero</a>) or, if your shape allows it, place the wrap point so that all the non-zero values come after the zeroes.
			</li>
			<li><code>ignoretrackscale</code> (ignoreTrackScaler)</li>
			<li><code>OnRequestTrackReshaping()[...].widthscaler</code>/<code>.heightscaler</code> (TrackServer.Node.trackScale)</li>
			<li><code>perTrackNodeScales</code>/<code>scales</code> (ringScales)</li>
		</ul>
	</dd>
	<dt>highwayscaledfollowmaxjumpheights (HIGHWAYSCALEDFOLLOWMAXJUMPHEIGHTS)</dt>
	<dd>
		<ul>
			<li>This special mode uses highway colors for the vertex colors but the Y component of the extrusion node origin is modified: <code>origin.y = <a href="mods.html#GetTrack" class=field>track</a>[i].pos.y + fif(<a href="mods.html#GetTrack" class=field>track</a>[i].maxAir &lt; <a href="mods.html#GameplaySettings" class=field>minimumjump_height</a> + 2, -9, <a href="mods.html#GetTrack" class=field>track</a>[i].maxAir)</code></li>
			<li><code><a href="mods.html#GameplaySettings" class=func>GameplaySettings</a>{<strong>minimumjump_height</strong>}</code> (CharacterManager.minimumJump_MaxHeight)</li>
			<li><code>stretch</code> (ringSpacing)</li>
			<li><code>flatten</code> (useGuardrailHeights)</li>
			<li><code>crossSectionShape</code> (extrusionPoints)</li>
			<li><code>perTrackNodeScales</code>/<code>scales</code> (ringScales)</li>
			<li><code>GetTrack()[...].maxAir</code> (TrackServer.Node.maxAir)</li>
			<li><code>perShapeNodeColorScalers</code> (extrusionColorScalers)</li>
			<li><code>perShapeNodeColorScalersScaleAlpha</code> (extrusionColorScalersScaleAlpha)</li>
		</ul>
	</dd>
</dl>

<h3 id="CreateRail-Rail_Default">Default Material</h3>
<p>If no material or shader is specified, the following material is used:</p>
<pre class=LuaCode><code>material = {
	shader = "<a href="shaders.html#shader-DiffuseVertexColored2">DiffuseVertexColored2</a>",
	texture = UnityEngine.Resources.Load("textures/White.png"),
	shadersettings = {
		_BumpAmt = 10,
		_Cutoff = 0.5,
		_EmissionLM = 0,
		_InvFade = 1,
		_Parallax = 0.02,
		_Rate = 300,
		_Shininess = 0.7,
		_farDistance = 20,
		_nearDistance = 10,
	},
	shadercolors = {
		_Color = {r=0.1701978, g=0.6251901, b=0.8842655, a=1}, <em>-- Currently, this will always get overwritten by the <strong>color</strong> setting.</em>
		_Emission = {r=0, g=0, b=0, a=0},
		_SpecColor = {r=0.090909, g=0, b=1, a=1},
		_TintColor = {r=1, g=1, b=1, a=0.5019608},
		_farColor = {r=0.00980173, g=0.6567164, b=0.6024298, a=1},
		_nearColor = {r=0.9850746, g=0, b=0, a=1},
	},
}</code></pre>


<h2 id="CreateRepeatedMeshRail">CreateRepeatedMeshRail{}</h2>
<pre><code><em>-- calls to this function after the <a href="#script-execution">first run</a> are ignored</em>
<a href="#type-globalname">globalname</a> <strong>globalName</strong> = nil <em>-- typeName: "RepeatedMeshRail"</em>
string prefabName = nil <em>-- If this is a valid name, <strong>gameobject</strong> will be ignored.</em>
<a href="#type-gameobject">gameobject</a> <strong>gameobject</strong> = nil
<a href="#type-float">float</a> <strong>ahead_renderdist</strong> = 500
<a href="#type-float">float</a> <strong>behind_renderdist</strong> = 25
<a href="#type-int">int</a> <strong>maxverticesperbatch</strong> = 50000
<a href="#type-float">float</a> <strong>spacing</strong> = 0
vector3[] offsets ?= nil <em>-- Must be the same length as <code>#<a href="#GetTrack" class=func>GetTrack</a>()</code>.</em>
vector3[] scales ?= nil <em>-- Parts of the rail where the interpolated X+Y scale is 0 will be skipped. If your array only contains scales of one and zero, no actual scaling will be performed but zeroes will still be skipped. Must be the same length as <code>#<a href="#GetTrack" class=func>GetTrack</a>()</code>.</em>
float track_tilt_factor ?= 1
<a href="#type-string">string</a> <strong>colorMode</strong> = "none" or "highway" or "highwayinverted"
<a href="#type-bool">bool</a> <strong>buildlive</strong> = false
<a href="#type-int">int</a> <strong>maxmeshesperbatch</strong> = 999999
<a href="#type-bool">bool</a> <strong>calculatenormals</strong> = false</code></pre>


<h2 id="CreateObject">CreateObject{}</h2>
<pre><code><a href="#type-globalname">globalname</a> <strong>globalName</strong> = nil <em>-- typeName: &quot;ro&quot;</em>
<a href="#type-string">string</a> <strong>name</strong> = nil <em>-- the <a href="glossary.html#prototype">prototype</a> name</em>
<a href="#type-gameobject">gameobject</a> <strong>gameobject</strong> = nil
<a href="#type-float">float</a> <strong>railoffset</strong> = nil <em>-- causes it to be "attached to the highway" if set to a number</em>
<em>-- if <strong>railoffset</strong> is a number</em>
<a href="#type-bool">bool</a> <strong>floatonwaterwaves</strong> = false
<a href="#type-float">float</a> <strong>tiltsmoother</strong> = 0 <em>-- "smooth tilt speed". if nonzero, turns on "smooth tilting"</em>
<em>-- else</em>
<a href="#type-int">int</a>/<a href="#type-string">string</a> <strong>tracknode</strong> = -1 or ("end" / "End" / "END") or ("start" / "Start" / "START") <em>-- if it is an <a href="#type-int">int</a> 0 or greater or "start" or "end", it attaches to that "node" on the highway</em>
<em>-- end</em>
int shapetotrack_at ?= nil <em>-- <a href="glossary.html#node">Track node</a> index, starting at 1.</em>
<a href="#type-bool">bool</a> <strong>active</strong> = ?
<a href="#type-bool">bool</a> <strong>visible</strong> = true</code></pre>
<ul class="seealso">
	<li><a href="glossary.html#game-object">game object</a></li>
	<li><a href="glossary.html#prefab">prefab</a></li>
	<li><a href="glossary.html#layer">layer</a></li>
	<li><a href="glossary.html#extrude">extrude</a></li>
</ul>


<h2 id="CreateRailedObject">CreateRailedObject{}</h2>
<p>An alias for <a href="#CreateObject">CreateObject{}</a>.</p>


<h2 id="CreatePrototype">CreatePrototype{}</h2>
<p>An alias for <a href="#CreateObject">CreateObject{}</a>.</p>


<h2 id="RepeatObject">RepeatObject{}</h2>
<pre><code>string prefabName = nil <em>-- Required. This refers to <a href="#CreateObject">CreateObject</a>{name} or a built-in object asset.</em>
int[] nodes = (throw NullReferenceException) <em>-- Zero-based track node indexes. (0 is the first node.)</em>
vector3[] offsets = {{0,0,0}, ...} <em>-- World-space offset from the corresponding node's position.</em>
vector3[] scales = {{1,1,1}, ...}
vector3[] rotations = {{0,0,0}, ...}
int count = 5 <em>-- The number of objects that will be visible simultaneously.</em>
int renderBehindDistance = 10 <em>-- Wait until an object's node is this many nodes behind <a href="https://www.lua.org/manual/5.1/manual.html#pdf-math.floor" class=func>math.floor</a>(<a href="#Update">tracklocation</a>) before reassigning it to a future node.</em></code></pre>
<ul class="seealso">
	<li><a href="#CreateObject">CreateObject</a></li>
	<li><a href="#GetTrack">GetTrack</a></li>
	<li><a href="glossary.html#node">node</a></li>
	<li><a href="glossary.html#world-space">world space</a></li>
	<li><a href="#BatchRenderEveryFrame">BatchRenderEveryFrame</a></li>
</ul>
<p>This seems to be similar in purpose to <code><a href="#BatchRenderEveryFrame">BatchRenderEveryFrame</a></code> except it uses a pool of real objects (attached components such as thrusters will work) and we are working in world space (offset by node position only) rather than node space. Once the player passes by an object's node, it will be teleported to the next node in <code>nodes</code> that an object hasn't been placed on already.</p>
<p>At startup it creates the specified number of <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Object.Instantiate.html">instances</a> of the specified object, leaves their transform at the original object's position, and assigns them to imaginary node <code>-1</code>. Whenever the current node minus <code>renderBehindDistance</code> is greater than an object's assigned node, it will get reassigned to the next unused node index in <code>nodes</code> and transformed accordingly. When it reaches the end of <code>nodes</code> it will stop making changes and the objects will continue to exist in their current locations.</p>
<p><code>prefabName</code> is first checked against the list of prototypes, which can be named objects created by CreateObject, or built-in prototypes. If no prototype is found, it will do <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Resources.Load.html" class=func>Resources.Load</a>(prefabName)</code> and then immediately unsafe-cast the result to <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/GameObject.html" class=type> UnityEngine.GameObject</a></code>. I am not sure if this can be exploited to instantiate other kinds of resources.</p>
<p>When working with the <code><a href="#GetTrack" class=func>GetTrack</a>()</code> array to choose nodes, you will need to subtract the Lua array indexes by one to convert it to the zero-based indexes expected by this function. An entry in <code>nodes</code> that is too large (<code>node[i] >= #<a href="#GetTrack" class=func>GetTrack</a>()</code>) will cause the rest of the array to be ignored. Negative indexes will throw IndexOutOfRangeException at the point where it attempts to assign an object to that node. If any of the other arrays are smaller than <code>nodes</code>, that array will be replaced with the default.</p>


<h2 id="BatchRenderEveryFrame">BatchRenderEveryFrame{}</h2>
<pre><code><a href="#type-string">string</a> <strong>prefabName</strong> <em>-- mandatory</em>
<a href="#type-int">int</a><a href="#type-array">[]</a> <strong>locations</strong> <em>-- mandatory. ints lower than 1 will be treated as 1</em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a>/<a href="#type-vector3">vector3</a> <strong>offsets</strong> = nil <em>-- <a href="#type-vector3">vector3</a><a href="#type-array">[]</a> version must be as long as <strong>locations</strong></em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a> <strong>scales</strong> = nil <em>-- only works if override_impactpositions, waterfloat, or songspeedratio are used. overrides the scale of the prefab rather than combining with it</em>
vector3[] rotations = nil
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a> <strong>override_impactpositions</strong> = nil <em>-- &quot;override node position&quot;</em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a> <strong>override_velocities</strong> = nil <em>-- &quot;override direction&quot;</em>
<a href="#type-int">int</a> <strong>afternodereached_numbernodesrendered</strong> = 50
<a href="#type-bool">bool</a> <strong>override_velocities_scaledbytrackspeed</strong> = true
<a href="#type-bool">bool</a> <strong>rotateWithTrack</strong> = true
<a href="#type-int">int</a> <strong>maxShown</strong> = 100 <em>-- earlier numbers in the <strong>locations</strong> array have priority over later ones when this limit is reached</em>
<a href="#type-int">int</a> <strong>maxDistanceShown</strong> = 600 <em>-- locations more than this many nodes away from the player will not be visible</em>
<a href="#type-bool">bool</a> <strong>testAndHideIfCollideWithTrack</strong> = false
<a href="#type-int">int</a> <strong>collisionLayer</strong> = -1
<a href="#type-bool">bool</a> <strong>waterfloat</strong> = false
<a href="#type-float">float</a> <strong>songspeedratio</strong> = nil <em>-- internal name "compression", is disabled unless you set this. cannot be switched off once enabled</em>
vector3[] worldspaceoffsets = nil
<a href="#type-color">color</a><a href="#type-array">[]</a>/<a href="#type-string">string</a> <strong>colors</strong> = nil or {...} or &quot;highway&quot; or &quot;highwayinverted&quot; or &quot;nodecolor&quot; <em>-- nodecolor sets the individual objects' colors to the node they are attached to. highway and highwayinverted act like <a href="#type-material">materialcolor</a>. highwayinverted is bugged and is identical to highway</em></code></pre>
<p><strong>The below documentation hasn't been updated for newly added settings <code>rotations</code> and <code>worldspaceoffsets</code>.</strong></p>
<p>Each number in <code><strong>locations</strong></code> is the index of a track node to place an instance at. (<code><a href="#GetTrack" class="func">GetTrack</a></code> gets a list of all nodes) The other optional array settings are used to modify specific instances specified in <code><strong>locations</strong></code>. If set, they should be the same array length as <code><strong>locations</strong></code> and the order of the entries determines which location they will influence.</p>
<p>By default, an instance is placed at the center of a node. <code><strong>offsets</strong></code> can be used to move them away from the center. Offset is relative to the node's position and rotation, so a positive X offset will always move it to the right of the track. Positive Y moves up and positive Z moves forward.</p>
<p>Here are some terms I will use in the following explanations:</p>
<dl>
	<dt>CurrentNode</dt>
	<dd>The fractional index of the track node that the player is currently &quot;on&quot;. (When the player is halfway between nodes 3 and 4, CurrentNode is 3.5)</dd>
	<dt>CurrentPos</dt>
	<dd>The world-space position of CurrentNode.</dd>
	<dt>CurrentTime</dt>
	<dd>The number of seconds into the song that CurrentNode represents.</dd>
	<dt>Track</dt>
	<dd>The array returned by <code><a href="#GetTrack" class="func">GetTrack</a>()</code>.</dd>
</dl>
<p>If you use <code><strong>songspeedratio</strong></code>, the numbers in <code><strong>locations</strong></code> are relative to CurrentNode rather than the beginning of the track. (the objects will move along with you) The number specified by <code><strong>songspeedratio</strong></code> scales the locations, allowing you to indirectly specify non-integers.</p>
<p><code><strong>maxDistanceShown</strong></code> is based on the difference between CurrentNode and the number in <code><strong>locations</strong></code>. The actual per-frame condition for hiding is <code><strong>locations</strong>[i] - CurrentNode &gt; <strong>maxDistanceShown</strong></code> so it won't re-hide objects later. Strangely, this behavior is not affected by <code><strong>songspeedratio</strong></code> in any way. Locations are still relative to the beginning of the track when considering distance. This means you probably want to set <code><strong>maxDistanceShown</strong></code> larger than the highest number in <code><strong>locations</strong></code> when using <code><strong>songspeedratio</strong></code> in order to disable it. Combining the two might be useful for some strange special effects.</p>
<p><code><strong>afternodereached_numbernodesrendered</strong></code> is  subtracted from CurrentNode and any location less than that value will be hidden. Like <code><strong>maxDistanceShown</strong></code>, this comparison is not affected by <code><strong>songspeedratio</strong></code>. For that frame, an instance hidden in this manner still counts toward the <code><strong>maxShown</strong></code> limit. Future frames will ignore that location and all earlier entries in the array. This can cause strange behavior if the values in <code><strong>locations</strong></code> aren't  sorted from lowest to highest.</p>
<p>If <code><strong>override_impactpositions</strong></code> and <code><strong>override_velocities</strong></code> are set, the actual per-frame position of the instances in world space will be <code>impactpositions + (x * velocities)</code> where x is the time until reaching the node specified in <code><strong>locations</strong></code>. (<code>CurrentTime - Track[<strong>locations</strong>[i]].seconds</code>) If <code><strong>override_velocities_scaledbytrackspeed</strong></code> is true, x will instead be the current playback node index minus the node index specified in <code><strong>locations</strong></code>, multiplied by 3. (<code>3 * (CurrentNode - <strong>locations</strong>[i])</code>) Overrides nullify the effects of <code><strong>offsets</strong></code>, <code><strong>rotateWithTrack</strong></code>, <code><strong>waterfloat</strong></code>, and <code><strong>songspeedratio</strong></code>. Ensure that those options are switched off for best performance. Overrides were added so the <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=188854551">Audiosphere</a> mod could render its falling meteors.</p>
<p><code><strong>override_velocities</strong></code> also overrides the angle of each instance by specifying a direction for the object to &quot;look&quot; toward. (<code>Quaternion.<a href="https://docs.unity3d.com/Documentation/ScriptReference/Quaternion.LookRotation.html">LookRotation</a>(override_velocities[i], Vector3(0, 1, 0))</code>) This can probably be abused to get rotated objects which don't appear to move by using a very small velocity. (since there isn't a &quot;rotations&quot; setting) Just be careful not to go smaller than <code><a href="#type-float">float</a></code> can support. Don't use completely zero velocities; it will probably spam errors to output_log.txt every frame.</p>
<p>Overrides, combined with <code><strong>maxDistanceShown</strong></code> and  <code><strong>afternodereached_numbernodesrendered</strong></code>, allow us to place an object at an arbitrary position in the world which appears at a certain time, moves from point A to point B, then disappears.</p>
<p>Instances hidden by <code><strong>testAndHideIfCollideWithTrack</strong></code> will still count toward the <code><strong>maxShown</strong></code> limit. I was unable to find how <code><strong>collisionLayer</strong></code> is honored but it may behave the same way.</p>


<h2 id="CreateSpriteBatch">CreateSpriteBatch{}</h2>
<pre><code><a href="#type-string">string</a> <strong>prefabName</strong> <em>-- mandatory</em>
<a href="#type-int">int</a><a href="#type-array">[]</a> <strong>locations</strong> <em>-- mandatory. ints lower than 1 will be treated as 1</em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a>/<a href="#type-vector3">vector3</a> <strong>offsets</strong> = nil <em>-- <a href="#type-vector3">vector3</a><a href="#type-array">[]</a> version must be as long as <strong>locations</strong></em>
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a>/<a href="#type-vector3">vector3</a> <strong>scales</strong> = nil <em>-- <a href="#type-vector3">vector3</a><a href="#type-array">[]</a> version must be as long as <strong>locations</strong></em>
<a href="#type-color">color</a><a href="#type-array">[]</a> <strong>colors</strong> = nil
<a href="#type-float">float</a><a href="#type-array">[]</a> <strong>repeaterSpacings</strong> = nil</code></pre>


<h2 id="AddForest">AddForest{}</h2>
<pre><code><a href="#type-globalname">globalname</a> <strong>globalName</strong> = nil <em>-- typeName: &quot;forest&quot;</em>
<a href="#type-gameobject">gameobject</a><a href="#type-array">[]</a> <strong>trees</strong> = nil
<a href="#type-string">string</a> <strong>objectorder</strong> = "random" or "sequential"
<a href="#type-int">int</a> <strong>minspacing</strong> = 1000
<a href="#type-int">int</a> <strong>maxspacing</strong> = 3000
<a href="#type-vector3">vector3</a><a href="#type-array">[]</a>/<a href="#type-table">table</a><a href="#type-array">[]</a> <strong>offsets</strong> = nil or {{0,0,0}, ...} or {{
	<a href="#type-vector3">vector3</a> <strong>min</strong> = {0,0,0}
	<a href="#type-vector3">vector3</a> <strong>max</strong> = <strong>min</strong>
}, ...}
<a href="#type-string">string</a> <strong>offsetorder</strong> = "random" or "sequential"
<a href="#type-bool">bool</a> <strong>collisiontest</strong> = true
<a href="#type-string">string</a> <strong>trackpositioncolorproperty</strong> = nil <em>-- this is the name of a shader color (same as the key names in <a href="#type-material">material</a>.shadercolors) which will be set to the track color of whatever location each object is at</em>
<a href="#type-int">int</a> <strong>numrendered</strong> = 50</code></pre>


<h2 id="CreateLight"><a href="#type-int">int</a> CreateLight{}</h2>
<p>Creates a <a href="https://docs.unity3d.com/Documentation/ScriptReference/Light.html">Unity Light</a>.</p>
<pre><code><a href="#type-globalname">globalname</a> <strong>globalName</strong> = nil <em>-- typeName: &quot;light&quot;</em>
<a href="#type-float">float</a> <strong>railoffset</strong> = nil <em>-- causes it to be "attached to the highway" if set to a number</em>
<em>-- if <strong>railoffset</strong> != nil then</em>
<a href="#type-bool">bool</a> <strong>floatonwaterwaves</strong> = false
<a href="#type-float">float</a> <strong>tiltsmoother</strong> = 0 <em>-- "smooth tilt speed". if nonzero, turns on "smooth tilting"</em>
<em>-- end</em>
<a href="#type-transform">transform</a> <strong>transform</strong> = nil
<a href="#type-string">string</a> <strong>type</strong> = "point" or "directional"
<a href="#type-materialcolor">materialcolor</a> <strong>color</strong> = ?
string mode = "auto" or "pixel" or "vertex"
<a href="#type-float">float</a> <strong>intensity</strong> = 0.5
<a href="#type-float">float</a> <strong>range</strong> = ?
<a href="#type-table">table</a> <strong>shadows</strong> ?= {
	<a href="#type-string">string</a> <strong>type</strong> = ("none" / "None") or ("soft" / "Soft") or ("hard" / "Hard")
	<a href="#type-float">float</a> <strong>strength</strong> ?= 1
	<a href="#type-float">float</a> <strong>bias</strong> ?= 0.05
	<a href="#type-float">float</a> <strong>softness</strong> ?= ? <em>-- Obsolete: Shadow softness is removed in Unity 5.0+</em>
	<a href="#type-float">float</a> <strong>softnessfade</strong> ?= ? <em>-- Obsolete: Shadow softness is removed in Unity 5.0+</em>
}</code></pre>


<h2 id="UpdateLight">UpdateLight{}</h2>
<pre><code>int light
transform transform ?= ?
materialcolor color ?= ?
float intensity = 0.5
float range ?= ?
table shadows ?= nil <em>-- this is the same as <a href="#CreateLight">CreateLight</a>{<strong>shadows</strong>}. omitting it disables shadows.</em></code></pre>


<h2 id="BuildMaterial"><a href="#type-UnityEngine.Material">UnityEngine.Material</a> BuildMaterial(<a href="#type-material">material</a>)</h2>
<p>Creates a material object and returns a reference to it. This allows a single material to be used on multiple objects with less waste, and allows the material to be modified during <code><a href="#Update" class=func>Update</a>()</code> via <code><a href="#UpdateMaterial" class=func>UpdateMaterial</a>{}</code> or the object's members. The object's members also give access to advanced settings.</p>


<h2 id="CreateMaterial"><a href="#type-UnityEngine.Material">UnityEngine.Material</a> CreateMaterial(<a href="#type-material">material</a>)</h2>
<p>An alias for <code><a href="#BuildMaterial" class=func>BuildMaterial</a>{}</code></p>


<h2 id="UpdateMaterial">UpdateMaterial(<a href="#type-table">table</a>)</h2>
<pre><code><a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong>
{string=float/vector4} shadersettings ?= ? <em>-- Omitted settings are left at their previous values. Types can be mixed.</em>
table texturesettings ?= ? or {
	<em>-- These settings only apply to the main texture.</em>
	vector2 offset ?= ?
	vector2 scale ?= ?
	vector2 tiling ?= ? <em>-- Same as <strong>scale</strong>.</em>
}
<a href="#type-shadercolors">shadercolors</a> shadercolors ?= ?
vector2 textureoffset ?= ? <em>-- Same as <strong>texturesettings.offset</strong>.</em>
vector2 texturescale ?= ? <em>-- Same as <strong>texturesettings.scale</strong>.</em></code></pre>
<p>Modifies an existing material. Useful for implementing animations inside the <code><a href="#Update" class=func>Update</a>()</code> function. Somewhat redundant now that the material object is exposed for direct changes.</p>
<ul class="seealso">
	<li><a href="#BuildMaterial">BuildMaterial</a></li>
</ul>


<h2 id="UpdateShaderSettings">UpdateShaderSettings(<a href="#type-table">table</a>)</h2>
<p>An alias for <code><a href="#UpdateMaterial" class=func>UpdateMaterial</a>{}</code></p>


<h2 id="BuildMesh"><a href="#type-mesh">mesh</a> BuildMesh{}</h2>
<p>Can be one of the following tables:</p>
<pre><code><a href="#type-address">address</a> <strong>mesh</strong> <em>-- Create a new mesh out of the specified model. This value is required.</em>
<a href="#type-bool">bool</a> <strong>calculateNormals</strong> = true <em>-- note the capital N in this version</em>
<a href="#type-bool">bool</a> <strong>calculateTangents</strong> = false
<a href="#type-bool">bool</a> <strong>submeshesWhenCombining</strong> = false
int shapetotrack_at = nil <em>-- A <a href="glossary.html#node">track node</a> id. (1 is the first node.)</em>
bool barycentricTangents = false
bool splitVertices = false</code></pre>
<pre><code>address[] meshes <em>-- mesh morphing</em>
<em>-- if <strong>meshes</strong> is a table</em>
	color[] meshcolors = nil
	bool barycentricTangents = false
	bool splitVertices = false
	bool usesequentialmode = false
	float sequentialspeed = 0
	string sequentialmode = nil or "loop" or "intensityloop" or "baycrowdloop" or "intensitymatch"
	bool recalculateNormalsEveryFrame = false
<em>-- else</em>
	UnityEngine.Mesh/<a href="#type-mesh">mesh</a> <strong>mesh</strong> = nil <em>-- If specified, modifies an existing mesh. (Procedural animations.)</em>
	<a href="#type-vector3">vector3</a><a href="#type-array">[]</a> <strong>vertextable</strong> ?= nil <em>-- Sets UnityEngine.Mesh.<a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/Mesh-vertices.html">vertices</a>.</em>
	<a href="#type-vector2">vector2</a><a href="#type-array">[]</a> <strong>uvtable</strong> ?= nil     <em>-- Sets UnityEngine.Mesh.<a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/Mesh-uv.html">uv</a>.</em>
	<a href="#type-color">color</a><a href="#type-array">[]</a> <strong>colortable</strong> ?= nil    <em>-- Sets UnityEngine.Mesh.<a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/Mesh-colors.html">colors</a>.</em>
	<a href="#type-int">int</a><a href="#type-array">[]</a> <strong>indextable</strong> ?= nil      <em>-- Sets UnityEngine.Mesh.<a href="https://docs.unity3d.com/2017.4/Documentation/ScriptReference/Mesh-triangles.html">triangles</a>. If it doesn't contain a zero, all of the numbers will be reduced by one (its indexing starts with 0).</em>
	<a href="#type-bool">bool</a> <strong>calculatenormals</strong> ?= false
<em>-- end if</em>
int shapetotrack_at = nil <em>-- A <a href="glossary.html#node">track node</a> id. (1 is the first node.)</em></code></pre>
<p>The <code><a href="#type-mesh">mesh</a></code> object returned by BuildMesh can be used instead of a filename in most functions that take an .obj file:</p>
<pre class="NppLua"><span class="sc11">exampleMesh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BuildMesh</span><span class="sc10">{</span><span class="sc0">
	</span><span class="sc11">mesh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"example.obj"</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">CreateObject</span><span class="sc10">{</span><span class="sc0">
	</span><span class="sc11">railoffset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">
	</span><span class="sc11">floatonwaterwaves</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">,</span><span class="sc0">
	</span><span class="sc11">gameobject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
		</span><span class="sc11">mesh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">exampleMesh</span><span class="sc10">,</span><span class="sc0">
		</span><span class="sc11">shader</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"VertexColorUnlitTinted"</span><span class="sc10">,</span><span class="sc0">
		</span><span class="sc11">shadercolors</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">_Color</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc10">},</span><span class="sc0">
	</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span></pre>
<p>See the documentation of the other functions for confirmation. One important exception is that mesh objects cannot be used for mesh morphing. It is possible to imitate mesh morphing via procedural animations.</p>
<p>BuildMesh has multiple uses:</p>
<ul>
	<li>Loading a model with custom settings.</li>
	<li>Procedural model generation.</li>
	<li>Procedural animation.</li>
	<li>Mesh morphing.</li>
</ul>
<h3 id="BuildMesh-procedural">Procedural Generation/Animation</h3>
<p>In general, you define vertices and their attributes with <code><strong>vertextable</strong></code>, <code><strong>uvtable</strong></code>, and <code><strong>colortable</strong></code>. Those 3 tables should be the same length or <code>nil</code> to leave them unchanged. To build faces from the vertices you define triangles by adding sets of 3 vertex indices, in clockwise order, to <code><strong>indextable</strong></code>.</p>
<p>(I haven't yet published any here but I have made animated spectrum visualizers with this. <a href="index.html#contact">Contact me</a> if you want examples/help.)</p>
<ul class="seealso">
	<li><a href="#UpdateMeshMorphWeights">UpdateMeshMorphWeights{}</a></li>
</ul>


<h2 id="UpdateMeshMorphWeights">UpdateMeshMorphWeights{}</h2>
<pre><code>mesh mesh
float[] weights</code></pre>
<ul class="seealso">
	<li><a href="#BuildMesh">BuildMesh{}</a></li>
</ul>


<h2 id="AddPostEffect">AddPostEffect{}</h2>
<pre><code>string depth = "background" or "foreground" or "topmost_exclusive" or ("middle" / "foreground_exceptclose") <em>-- Selects camera.</em>
<a href="#type-UnityEngine.Material">UnityEngine.Material</a> <strong>material</strong> = nil <em>-- Only accepts <a href="#BuildMaterial">pre-built</a> materials. Specifying this does not prevent "builtin" from being read, and both will be added to the specified camera.</em>
table builtin = nil or {
	string name = nil or (<a href="#AddPostEffect-builtin">see below</a>) <em>-- A valid name is required or builtin will be ignored.</em>
	<em>-- Other values, depending on the name. <a href="#AddPostEffect-builtin">See below</a> for all the variations.</em>
}</code></pre>
<p>Attaches a post-processing effect to the selected <a href="magic-literals.html#cameras">camera</a>:</p>
<ul>
	<li><code>background</code>: The <a href="magic-literals.html#camera-bg">background camera</a>. Covers objects on layers 18 and 19.</li>
	<li><code>middle</code> / <code>foreground_exceptclose</code>: The <a href="magic-literals.html#camera-fg">foreground camera</a>. Covers objects on layers 11, 12, 13, 18, and 19.</li>
	<li><code>foreground</code>: The <a href="magic-literals.html#camera-close">close camera</a>. Covers objects on layers 11, 12, 13, 14, 15, 18, and 19.</li>
	<li><code>topmost_exclusive</code>: The <a href="magic-literals.html#camera-close-blitter">close blitter camera</a>. Adding a <code>material</code> effect to this camera switches the <a href="magic-literals.html#camera-close">close camera</a> to <a href="#AddPostEffect-material-blitter-mode">blitter mode</a>. Covers objects on layers 14 and 15.</li>
</ul>
<ul class="seealso">
	<li><a href="magic-literals.html#layers">Layers</a></li>
	<li><a href="https://docs.unity3d.com/2017.3/Documentation/Manual/PostProcessingWritingEffects.html">Unity post-processing effects</a></li>
</ul>

<h3 id="AddPostEffect-material"><code>material</code> Post Effects</h3>
<p>This adds a material to a multi-material effect named <code>PostEffects</code>. The material's shader receives the camera view through the main texture (<code>_MainTex</code>) and it is drawn as a <a href="glossary.html#quad">quad</a> covering the camera.</p>
<p>If the effect has 1 material, it does <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Graphics.Blit.html" class=func>Graphics.Blit</a>(<span title=source>src</span>, <span title=destination>dest</span>, material)</code>. If someone wants this code path but wants to do multiple <code>material</code> effects, they might be able to use a single material with a custom multi-pass shader, using <a href="https://docs.unity3d.com/2017.3/Documentation/Manual/SL-UsePass.html">UsePass</a> and <a href="https://docs.unity3d.com/2017.3/Documentation/Manual/SL-GrabPass.html">GrabPass</a> as needed.</p>
<p>If there are multiple materials, they are chained together in the order they were added by <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Graphics.Blit.html">blitting</a> to <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/RenderTexture.GetTemporary.html">pooled</a> <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/RenderTexture.html" class=type>RenderTexture</a></code> objects. The first material receives directly from <code>src</code> and the last one outputs directly to <code>dest</code>. RenderTexture settings:</p>
<ul>
	<li>Depth buffer: 24 bit</li>
	<li>Format: ARGB32</li>
	<li>Colors: <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/RenderTextureReadWrite.html">Default</a></li>
</ul>
<p>If the effect has 0 materials but is somehow enabled, it does <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/Graphics.Blit.html" class=func>Graphics.Blit</a>(src, dest)</code>, making it effectively an <a href="https://en.wikipedia.org/wiki/Identity_function">identity function</a>. We can get this state by specifying no <code>material</code> along with an invalid <code>builtin</code> that causes an exception to be thrown, then <a href="https://www.lua.org/manual/5.1/manual.html#pdf-pcall">catching</a> the exception after it leaves <code>AddPostEffect</code>. Setting an <code>address</code> to something other than a <code>string</code> or <code>nil</code> should cause an <code>InvalidCastException</code>.</p>
<h4 id="AddPostEffect-material-blitter-mode">Blitter Mode</h4>
<p>There is special behavior when adding a <code>material</code> post effect to the <a href="magic-literals.html#camera-close-blitter">close blitter camera</a>: The <a href="magic-literals.html#camera-close">close camera</a> will be assigned a background color and a <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/RenderTexture.html" class=type>RenderTexture</a></code>, which will be used as the  source for the <a href="magic-literals.html#camera-close-blitter">close blitter camera</a> rather than reading from the screen buffer. The blit output will also be <code>null</code> (the screen) rather than <code>dest</code>. Settings:</p>
<ul>
	<li>RenderTexture depth buffer: 24 bit</li>
	<li>RenderTexture format: ARGB32</li>
	<li>RenderTexture Colors: <a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/RenderTextureReadWrite.html">Linear</a></li>
	<li>Camera background color: <code>{0,0,0,0}</code></li>
</ul>

<h3 id="AddPostEffect-builtin"><code>builtin</code> Post Effects</h3>
<p>This allows scripts to utilize some Unity post effects that have been integrated into Audiosurf 2. If <code>material</code> and <code>builtin</code> effects are mixed on the same camera, <code>PostEffects</code> is always the first component to be added. Post effects <a href="https://docs.unity3d.com/2017.3/Documentation/Manual/PostProcessingWritingEffects.html">should</a> render in the order they are added to the camera.</p>
<h4 id="AddPostEffect-builtin-AmplifyColor">Amplify Color</h4>
<p>An older version of <a href="https://github.com/AmplifyCreations/AmplifyColor">Amplify Color</a>. Adds <a href="https://github.com/AmplifyCreations/AmplifyColor/blob/master/Assets/AmplifyColor/Plugins/AmplifyColorEffect.cs">AmplifyColorEffect</a> with the old version's default settings.</p>
<pre><code>string name = "amplifycolor" / "AmplifyColor"
float blendamount = 0 <em>-- BlendAmount</em>
address lut = nil <em>-- LutTexture, clamp, no mipmaps</em>
address blendlut = nil <em>-- LutBlendTexture, clamp, no mipmaps</em>
address mask = nil <em>-- MaskTexture, clamp, no mipmaps</em></code></pre>
<h4 id="AddPostEffect-builtin-CandelaSSRR">Candela SSRR (?)</h4>
<p>Enables the <a href="https://forum.unity.com/threads/released-candela-ssrr-v2-advanced-screen-space-pbs-reflections-for-unity-5.342803/">Candela SSRR</a> effect. (Screen Space Ray-traced Reflections) All it does is check if the object exists and, if found, activates it. I can't find the class in the version of Audiosurf 2 I am looking at, and it was made for an older version of Unity, so <strong>this might be a removed feature</strong>. Because this component is added in the editor, like <code>PostEffects</code>, I am not sure which one renders first.</p>
<pre><code>string name = "CandelaSSR" / "CandelaSSRR" / "SSR" / "ssr"
<em>-- no options</em></code></pre>
<h4 id="AddPostEffect-builtin-HeathenSelectiveGlow">Heathen's Selective Glow</h4>
<p>The <a href="https://forum.unity.com/threads/heathens-selective-glow.228352/">Heathen's Selective Glow</a> effect. Adds <code>SelectiveGlow</code> with the following settings:</p>
<ul>
	<li>compositeShader: <code>"Hidden/Composite Selective Glow "</code>, if it exists, or <code>"Hidden/Composite Selective Glow"</code></li>
	<li>renderGlowShader: <code>"Hidden/Render Selective Glow"</code></li>
	<li>blurShader: <code>"Hidden/HeathenBlurConeTap"</code></li>
	<li>fastBlurShader: <code>"Hidden/_HeathenFastBlur"</code></li>
	<li>UseFastBlur: if <code><a href="#GetQualityLevel4" class=func>GetQualityLevel4</a>() &lt;= 1</code></li>
</ul>
<pre><code>string name = "SelectiveGlow" / "selectiveglow" / "HeathenSelectiveGlow"
<em>-- no options</em></code></pre>
<h4 id="AddPostEffect-builtin-">SE Natural Bloom Dirty Lens</h4>
<p><a href="https://forum.unity.com/threads/se-natural-bloom-dirty-lens.243430/">Sonic Ether's Natural Bloom Dirty Lens</a> effect. Adds <a href="https://github.com/sonicether/SE-Natural-Bloom-Dirty-Lens/blob/bc15de63773354ca99d2a24abe065814e8ba60cf/Assets/SE%20Natural%20Bloom/Scripts/SENaturalBloomAndDirtyLens.cs">SENaturalBloomAndDirtyLens</a> with default settings.</p>
<pre><code>string name = "SENaturalBloomAndDirtyLens" / "NaturalBloom" / "SENaturalBloom" / "senaturalbloom" / "naturalbloom"
float dirtintensity = 0.05 <em>-- <a href="https://github.com/sonicether/SE-Natural-Bloom-Dirty-Lens/blob/bc15de63773354ca99d2a24abe065814e8ba60cf/Assets/SE%20Natural%20Bloom/Scripts/SENaturalBloomAndDirtyLens.cs#L24">lensDirtIntensity</a>, suggested range is 0.0 to 0.95</em>
float bloomintensity = 0.05 <em>-- <a href="https://github.com/sonicether/SE-Natural-Bloom-Dirty-Lens/blob/bc15de63773354ca99d2a24abe065814e8ba60cf/Assets/SE%20Natural%20Bloom/Scripts/SENaturalBloomAndDirtyLens.cs#L18">bloomIntensity</a>, suggested range is 0.0 to 0.4</em>
address dirt = nil <em>-- <a href="https://github.com/sonicether/SE-Natural-Bloom-Dirty-Lens/blob/bc15de63773354ca99d2a24abe065814e8ba60cf/Assets/SE%20Natural%20Bloom/Scripts/SENaturalBloomAndDirtyLens.cs#L26">lensDirtTexture</a>, clamp, no mipmaps</em></code></pre>
<h4 id="AddPostEffect-builtin-SSAOPro">SSAO Pro</h4>
<p>The <a href="https://forum.unity.com/threads/ssao-pro-high-quality-screen-space-ambient-occlusion.274003/">SSAO Pro</a> effect. Adds <code>SSAOPro</code> with default settings.</p>
<ul class="seealso">
	<li><a href="https://en.wikipedia.org/wiki/Screen_space_ambient_occlusion">Screen-Space Ambient Occlusion</a></li>
</ul>
<pre><code>string name = "SSAOPro" / "ssaopro" / "ssao" / "SSAO"
<em>-- no options</em></code></pre>
<h4 id="AddPostEffect-builtin-GlobalFog">Global Fog</h4>
<p>This is implied to be the <a href="https://docs.unity3d.com/550/Documentation/Manual/script-GlobalFog.html">Global Fog</a> effect from the Unity 5 "Pro only" standard effects package. Adds a <code>GlobalFogU5</code> effect:</p>
<ul>
	<li>fogShader: "Hidden/GlobalFogU5"</li>
	<li>heightDensity: 0.0075f (suggested range: 0.001 to 10)</li>
	<li>heightFog: true ("Apply height-based fog?")</li>
	<li>useRadialDistance: false ("Distance fog is based on radial distance from camera when checked")</li>
	<li>startDistance: 0 ("Push fog away from the camera by this amount")</li>
</ul>
<p>It also takes some fog settings from <code><a href="https://docs.unity3d.com/2017.3/Documentation/ScriptReference/RenderSettings.html">RenderSettings</a></code> (<code>fogMode</code>, <code>fogDensity</code>, <code>fogStartDistance</code>, <code>fogEndDistance</code>), so <code><a href="#SetScene" class=func>SetScene</a>{fogenabled,fogcolor,fogdensity,fogstart,fogend}</code> will change this effect.</p>
<pre><code>string name = "GlobalFog"
float height = -400 <em>-- "Fog top Y coordinate"</em></code></pre>

<h3 id="AddPostEffect-manual">Manual Effects</h3>
<p>With custom shaders it has always been possible to use special vertex shaders to position geometry directly in screen space without using <code>AddPostEffect</code> and sample the screen using <a href="https://docs.unity3d.com/2017.3/Documentation/Manual/SL-GrabPass.html">GrabPass</a>. An example is available <a href="lib/postprocess_example.html">here</a>.</p>
<!-- InstanceEndEditable -->
</body>
<!-- InstanceEnd --></html>